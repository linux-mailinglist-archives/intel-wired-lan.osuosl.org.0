Return-Path: <intel-wired-lan-bounces@osuosl.org>
X-Original-To: lists+intel-wired-lan@lfdr.de
Delivered-To: lists+intel-wired-lan@lfdr.de
Received: from silver.osuosl.org (smtp3.osuosl.org [140.211.166.136])
	by mail.lfdr.de (Postfix) with ESMTPS id A5B081C71A6
	for <lists+intel-wired-lan@lfdr.de>; Wed,  6 May 2020 15:28:29 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by silver.osuosl.org (Postfix) with ESMTP id 4987F20008;
	Wed,  6 May 2020 13:28:28 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from silver.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id gDFHTrXxBoHv; Wed,  6 May 2020 13:28:28 +0000 (UTC)
Received: from ash.osuosl.org (ash.osuosl.org [140.211.166.34])
	by silver.osuosl.org (Postfix) with ESMTP id 67C1E204DD;
	Wed,  6 May 2020 13:28:24 +0000 (UTC)
X-Original-To: intel-wired-lan@lists.osuosl.org
Delivered-To: intel-wired-lan@lists.osuosl.org
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by ash.osuosl.org (Postfix) with ESMTP id 078ED1BF866
 for <intel-wired-lan@lists.osuosl.org>; Wed,  6 May 2020 13:28:23 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by hemlock.osuosl.org (Postfix) with ESMTP id 01E628879B
 for <intel-wired-lan@lists.osuosl.org>; Wed,  6 May 2020 13:28:23 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id Lk+Hc-FIVFTR for <intel-wired-lan@lists.osuosl.org>;
 Wed,  6 May 2020 13:28:21 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mail-pl1-f195.google.com (mail-pl1-f195.google.com
 [209.85.214.195])
 by hemlock.osuosl.org (Postfix) with ESMTPS id 878B4885C6
 for <intel-wired-lan@lists.osuosl.org>; Wed,  6 May 2020 13:28:21 +0000 (UTC)
Received: by mail-pl1-f195.google.com with SMTP id s20so497511plp.6
 for <intel-wired-lan@lists.osuosl.org>; Wed, 06 May 2020 06:28:21 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=xJiERueZdR8AIL+W94ibTBxul8R+TyiF09HDqYKZujA=;
 b=othpy/s3bbn2Z3SuplVaHUXD0Xoue8wd+ea3yQZNtr22aFX7zKiYy96vkZu7TLjgSk
 CK1jSteEhpnSpARk4uAC3gjj78yWA00Mj24llTojAzNvB5n+5EMhgQn5Okkr5vRKgxl/
 lUnBug/MoqBuTjTCLpgvqZXkOYXxCDxKpcCyMTZFPoGq9/TawW7L+oSM4BsxiWAjndct
 S3ipRaoX9HKdwcY7ManWc1Dq7IcxoRo7ortCdbXr/n31EVkkR6GsTi3dLTFiA+0iPA4g
 PlaTIuGEi9XfqXNnT2/6aYTjYV3OwnCBl7+s78Hzge4E/0B1ThKVTVrNNE/as03ttxrU
 l1Hg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=xJiERueZdR8AIL+W94ibTBxul8R+TyiF09HDqYKZujA=;
 b=dRf6TAwJuBX/USFm8oRO9KHgdpgkgNEZ4+nrtDAIxMcmVlfz7wUjygngjCvaMJURuA
 yc2hpjb/6kZzhaII9CZ4cCIL5lNavNvFOqGIVbPDgdE5p/R0qjtU+cIaYw3WrTEhF2/0
 Y9FvVfQu6bYJOYKmhxZAtgaPUToakNcv/I+rxkBLUwlv1iiYZa1jwbW2DWfCZVu98j3I
 V9DzHiXUYdj7WR9Mnp7lCT8Nx1dTxBsrPo6h2F3e0u6H1VcEE1k+RLJ4lCiovxatTUdg
 llC6pBRjv49s7C4d1oAcX8N4+Ub8srJsClfWrCljRuba9uTzLshlzYyD0h7XIhyrSSXO
 NBdw==
X-Gm-Message-State: AGi0PubY3WknrY8gfnijKVBmFkgULtQeUdyxGzgbGEOWWs8fm6KlR8sj
 DcU2AcnSXYVRz15KqWrYKHmSwDshrkHTdg==
X-Google-Smtp-Source: APiQypJ8KbYSePxDb4gUVZjUnWKl4UZSn+nrssL3wTa6BawjtIF16IDCTNrsptw0YVJ6uyQUj88fnw==
X-Received: by 2002:a17:90a:eb05:: with SMTP id
 j5mr8914377pjz.86.1588771701046; 
 Wed, 06 May 2020 06:28:21 -0700 (PDT)
Received: from btopel-mobl.ger.intel.com (fmdmzpr04-ext.fm.intel.com.
 [192.55.55.39])
 by smtp.gmail.com with ESMTPSA id e135sm1908495pfh.37.2020.05.06.06.28.18
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 06 May 2020 06:28:20 -0700 (PDT)
From: =?UTF-8?q?Bj=C3=B6rn=20T=C3=B6pel?= <bjorn.topel@gmail.com>
To: maximmi@mellanox.com,
	bjorn.topel@intel.com
Date: Wed,  6 May 2020 15:27:41 +0200
Message-Id: <20200506132746.526188-10-bjorn.topel@gmail.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20200506132746.526188-1-bjorn.topel@gmail.com>
References: <20200506132746.526188-1-bjorn.topel@gmail.com>
MIME-Version: 1.0
Subject: [Intel-wired-lan] [PATCH bpf-next pre-v1 MAXONLY 09/14] ixgbe,
 xsk: migrate to new MEM_TYPE_XSK_BUFF_POOL
X-BeenThere: intel-wired-lan@osuosl.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel Wired Ethernet Linux Kernel Driver Development
 <intel-wired-lan.osuosl.org>
List-Unsubscribe: <https://lists.osuosl.org/mailman/options/intel-wired-lan>, 
 <mailto:intel-wired-lan-request@osuosl.org?subject=unsubscribe>
List-Archive: <http://lists.osuosl.org/pipermail/intel-wired-lan/>
List-Post: <mailto:intel-wired-lan@osuosl.org>
List-Help: <mailto:intel-wired-lan-request@osuosl.org?subject=help>
List-Subscribe: <https://lists.osuosl.org/mailman/listinfo/intel-wired-lan>,
 <mailto:intel-wired-lan-request@osuosl.org?subject=subscribe>
Cc: intel-wired-lan@lists.osuosl.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-wired-lan-bounces@osuosl.org
Sender: "Intel-wired-lan" <intel-wired-lan-bounces@osuosl.org>

RnJvbTogQmrDtnJuIFTDtnBlbCA8Ympvcm4udG9wZWxAaW50ZWwuY29tPgoKUmVtb3ZlIE1FTV9U
WVBFX1pFUk9fQ09QWSBpbiBmYXZvciBvZiB0aGUgbmV3IE1FTV9UWVBFX1hTS19CVUZGX1BPT0wK
QVBJcy4KCkNjOiBpbnRlbC13aXJlZC1sYW5AbGlzdHMub3N1b3NsLm9yZwpTaWduZWQtb2ZmLWJ5
OiBCasO2cm4gVMO2cGVsIDxiam9ybi50b3BlbEBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9uZXQv
ZXRoZXJuZXQvaW50ZWwvaXhnYmUvaXhnYmUuaCAgICAgIHwgICA5ICstCiBkcml2ZXJzL25ldC9l
dGhlcm5ldC9pbnRlbC9peGdiZS9peGdiZV9tYWluLmMgfCAgMTUgKy0KIC4uLi9ldGhlcm5ldC9p
bnRlbC9peGdiZS9peGdiZV90eHJ4X2NvbW1vbi5oICB8ICAgMiArLQogZHJpdmVycy9uZXQvZXRo
ZXJuZXQvaW50ZWwvaXhnYmUvaXhnYmVfeHNrLmMgIHwgMzA1ICsrKy0tLS0tLS0tLS0tLS0tLQog
NCBmaWxlcyBjaGFuZ2VkLCA2MiBpbnNlcnRpb25zKCspLCAyNjkgZGVsZXRpb25zKC0pCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9uZXQvZXRoZXJuZXQvaW50ZWwvaXhnYmUvaXhnYmUuaCBiL2RyaXZl
cnMvbmV0L2V0aGVybmV0L2ludGVsL2l4Z2JlL2l4Z2JlLmgKaW5kZXggMjgzM2U0ZjA0MWNlLi41
ZGRmYzgzYTFlNDYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvbmV0L2V0aGVybmV0L2ludGVsL2l4Z2Jl
L2l4Z2JlLmgKKysrIGIvZHJpdmVycy9uZXQvZXRoZXJuZXQvaW50ZWwvaXhnYmUvaXhnYmUuaApA
QCAtMjI0LDE3ICsyMjQsMTcgQEAgc3RydWN0IGl4Z2JlX3R4X2J1ZmZlciB7CiB9OwogCiBzdHJ1
Y3QgaXhnYmVfcnhfYnVmZmVyIHsKLQlzdHJ1Y3Qgc2tfYnVmZiAqc2tiOwotCWRtYV9hZGRyX3Qg
ZG1hOwogCXVuaW9uIHsKIAkJc3RydWN0IHsKKwkJCXN0cnVjdCBza19idWZmICpza2I7CisJCQlk
bWFfYWRkcl90IGRtYTsKIAkJCXN0cnVjdCBwYWdlICpwYWdlOwogCQkJX191MzIgcGFnZV9vZmZz
ZXQ7CiAJCQlfX3UxNiBwYWdlY250X2JpYXM7CiAJCX07CiAJCXN0cnVjdCB7Ci0JCQl2b2lkICph
ZGRyOwotCQkJdTY0IGhhbmRsZTsKKwkJCWJvb2wgZGlzY2FyZDsKKwkJCXN0cnVjdCB4ZHBfYnVm
ZiAqeGRwOwogCQl9OwogCX07CiB9OwpAQCAtMzUxLDcgKzM1MSw2IEBAIHN0cnVjdCBpeGdiZV9y
aW5nIHsKIAl9OwogCXN0cnVjdCB4ZHBfcnhxX2luZm8geGRwX3J4cTsKIAlzdHJ1Y3QgeGRwX3Vt
ZW0gKnhza191bWVtOwotCXN0cnVjdCB6ZXJvX2NvcHlfYWxsb2NhdG9yIHpjYTsgLyogWkMgYWxs
b2NhdG9yIGFuY2hvciAqLwogCXUxNiByaW5nX2lkeDsJCS8qIHtyeCx0eCx4ZHB9X3JpbmcgYmFj
ayByZWZlcmVuY2UgaWR4ICovCiAJdTE2IHJ4X2J1Zl9sZW47CiB9IF9fX19jYWNoZWxpbmVfaW50
ZXJub2RlYWxpZ25lZF9pbl9zbXA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL25ldC9ldGhlcm5ldC9p
bnRlbC9peGdiZS9peGdiZV9tYWluLmMgYi9kcml2ZXJzL25ldC9ldGhlcm5ldC9pbnRlbC9peGdi
ZS9peGdiZV9tYWluLmMKaW5kZXggNzE4OTMxZDk1MWJjLi5kYTdiODA0MjkwMWYgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvbmV0L2V0aGVybmV0L2ludGVsL2l4Z2JlL2l4Z2JlX21haW4uYworKysgYi9k
cml2ZXJzL25ldC9ldGhlcm5ldC9pbnRlbC9peGdiZS9peGdiZV9tYWluLmMKQEAgLTM1LDcgKzM1
LDcgQEAKICNpbmNsdWRlIDxuZXQvdGNfYWN0L3RjX21pcnJlZC5oPgogI2luY2x1ZGUgPG5ldC92
eGxhbi5oPgogI2luY2x1ZGUgPG5ldC9tcGxzLmg+Ci0jaW5jbHVkZSA8bmV0L3hkcF9zb2NrLmg+
CisjaW5jbHVkZSA8bmV0L3hkcF9zb2NrX2Rydi5oPgogI2luY2x1ZGUgPG5ldC94ZnJtLmg+CiAK
ICNpbmNsdWRlICJpeGdiZS5oIgpAQCAtMzcyNiw4ICszNzI2LDcgQEAgc3RhdGljIHZvaWQgaXhn
YmVfY29uZmlndXJlX3NycmN0bChzdHJ1Y3QgaXhnYmVfYWRhcHRlciAqYWRhcHRlciwKIAogCS8q
IGNvbmZpZ3VyZSB0aGUgcGFja2V0IGJ1ZmZlciBsZW5ndGggKi8KIAlpZiAocnhfcmluZy0+eHNr
X3VtZW0pIHsKLQkJdTMyIHhza19idWZfbGVuID0gcnhfcmluZy0+eHNrX3VtZW0tPmNodW5rX3Np
emVfbm9ociAtCi0JCQkJICBYRFBfUEFDS0VUX0hFQURST09NOworCQl1MzIgeHNrX2J1Zl9sZW4g
PSB4c2tfdW1lbV9nZXRfcnhfZnJhbWVfc2l6ZShyeF9yaW5nLT54c2tfdW1lbSk7CiAKIAkJLyog
SWYgdGhlIE1BQyBzdXBwb3J0IHNldHRpbmcgUlhEQ1RMLlJMUE1MLCB0aGUKIAkJICogU1JSQ1RM
W25dLkJTSVpFUEtUIGlzIHNldCB0byBQQUdFX1NJWkUgYW5kCkBAIC00MDc0LDExICs0MDczLDEw
IEBAIHZvaWQgaXhnYmVfY29uZmlndXJlX3J4X3Jpbmcoc3RydWN0IGl4Z2JlX2FkYXB0ZXIgKmFk
YXB0ZXIsCiAJeGRwX3J4cV9pbmZvX3VucmVnX21lbV9tb2RlbCgmcmluZy0+eGRwX3J4cSk7CiAJ
cmluZy0+eHNrX3VtZW0gPSBpeGdiZV94c2tfdW1lbShhZGFwdGVyLCByaW5nKTsKIAlpZiAocmlu
Zy0+eHNrX3VtZW0pIHsKLQkJcmluZy0+emNhLmZyZWUgPSBpeGdiZV96Y2FfZnJlZTsKIAkJV0FS
Tl9PTih4ZHBfcnhxX2luZm9fcmVnX21lbV9tb2RlbCgmcmluZy0+eGRwX3J4cSwKLQkJCQkJCSAg
IE1FTV9UWVBFX1pFUk9fQ09QWSwKLQkJCQkJCSAgICZyaW5nLT56Y2EpKTsKLQorCQkJCQkJICAg
TUVNX1RZUEVfWFNLX0JVRkZfUE9PTCwKKwkJCQkJCSAgIE5VTEwpKTsKKwkJeHNrX2J1ZmZfc2V0
X3J4cV9pbmZvKHJpbmctPnhza191bWVtLCAmcmluZy0+eGRwX3J4cSk7CiAJfSBlbHNlIHsKIAkJ
V0FSTl9PTih4ZHBfcnhxX2luZm9fcmVnX21lbV9tb2RlbCgmcmluZy0+eGRwX3J4cSwKIAkJCQkJ
CSAgIE1FTV9UWVBFX1BBR0VfU0hBUkVELCBOVUxMKSk7CkBAIC00MTM0LDggKzQxMzIsNyBAQCB2
b2lkIGl4Z2JlX2NvbmZpZ3VyZV9yeF9yaW5nKHN0cnVjdCBpeGdiZV9hZGFwdGVyICphZGFwdGVy
LAogCX0KIAogCWlmIChyaW5nLT54c2tfdW1lbSAmJiBody0+bWFjLnR5cGUgIT0gaXhnYmVfbWFj
XzgyNTk5RUIpIHsKLQkJdTMyIHhza19idWZfbGVuID0gcmluZy0+eHNrX3VtZW0tPmNodW5rX3Np
emVfbm9ociAtCi0JCQkJICBYRFBfUEFDS0VUX0hFQURST09NOworCQl1MzIgeHNrX2J1Zl9sZW4g
PSB4c2tfdW1lbV9nZXRfcnhfZnJhbWVfc2l6ZShyaW5nLT54c2tfdW1lbSk7CiAKIAkJcnhkY3Rs
ICY9IH4oSVhHQkVfUlhEQ1RMX1JMUE1MTUFTSyB8CiAJCQkgICAgSVhHQkVfUlhEQ1RMX1JMUE1M
X0VOKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvbmV0L2V0aGVybmV0L2ludGVsL2l4Z2JlL2l4Z2Jl
X3R4cnhfY29tbW9uLmggYi9kcml2ZXJzL25ldC9ldGhlcm5ldC9pbnRlbC9peGdiZS9peGdiZV90
eHJ4X2NvbW1vbi5oCmluZGV4IDZkMDE3MDBiNDZiYy4uNzg4N2FlNGFhZjRmIDEwMDY0NAotLS0g
YS9kcml2ZXJzL25ldC9ldGhlcm5ldC9pbnRlbC9peGdiZS9peGdiZV90eHJ4X2NvbW1vbi5oCisr
KyBiL2RyaXZlcnMvbmV0L2V0aGVybmV0L2ludGVsL2l4Z2JlL2l4Z2JlX3R4cnhfY29tbW9uLmgK
QEAgLTM1LDcgKzM1LDcgQEAgaW50IGl4Z2JlX3hza191bWVtX3NldHVwKHN0cnVjdCBpeGdiZV9h
ZGFwdGVyICphZGFwdGVyLCBzdHJ1Y3QgeGRwX3VtZW0gKnVtZW0sCiAKIHZvaWQgaXhnYmVfemNh
X2ZyZWUoc3RydWN0IHplcm9fY29weV9hbGxvY2F0b3IgKmFsbG9jLCB1bnNpZ25lZCBsb25nIGhh
bmRsZSk7CiAKLXZvaWQgaXhnYmVfYWxsb2NfcnhfYnVmZmVyc196YyhzdHJ1Y3QgaXhnYmVfcmlu
ZyAqcnhfcmluZywgdTE2IGNsZWFuZWRfY291bnQpOworYm9vbCBpeGdiZV9hbGxvY19yeF9idWZm
ZXJzX3pjKHN0cnVjdCBpeGdiZV9yaW5nICpyeF9yaW5nLCB1MTYgY2xlYW5lZF9jb3VudCk7CiBp
bnQgaXhnYmVfY2xlYW5fcnhfaXJxX3pjKHN0cnVjdCBpeGdiZV9xX3ZlY3RvciAqcV92ZWN0b3Is
CiAJCQkgIHN0cnVjdCBpeGdiZV9yaW5nICpyeF9yaW5nLAogCQkJICBjb25zdCBpbnQgYnVkZ2V0
KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvbmV0L2V0aGVybmV0L2ludGVsL2l4Z2JlL2l4Z2JlX3hz
ay5jIGIvZHJpdmVycy9uZXQvZXRoZXJuZXQvaW50ZWwvaXhnYmUvaXhnYmVfeHNrLmMKaW5kZXgg
NWI2ZWRiZDhhNGVkLi4xMmY1ZGMzZmU3NmUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvbmV0L2V0aGVy
bmV0L2ludGVsL2l4Z2JlL2l4Z2JlX3hzay5jCisrKyBiL2RyaXZlcnMvbmV0L2V0aGVybmV0L2lu
dGVsL2l4Z2JlL2l4Z2JlX3hzay5jCkBAIC0yMCw1NCArMjAsMTEgQEAgc3RydWN0IHhkcF91bWVt
ICppeGdiZV94c2tfdW1lbShzdHJ1Y3QgaXhnYmVfYWRhcHRlciAqYWRhcHRlciwKIAlyZXR1cm4g
eGRwX2dldF91bWVtX2Zyb21fcWlkKGFkYXB0ZXItPm5ldGRldiwgcWlkKTsKIH0KIAotc3RhdGlj
IGludCBpeGdiZV94c2tfdW1lbV9kbWFfbWFwKHN0cnVjdCBpeGdiZV9hZGFwdGVyICphZGFwdGVy
LAotCQkJCSAgc3RydWN0IHhkcF91bWVtICp1bWVtKQotewotCXN0cnVjdCBkZXZpY2UgKmRldiA9
ICZhZGFwdGVyLT5wZGV2LT5kZXY7Ci0JdW5zaWduZWQgaW50IGksIGo7Ci0JZG1hX2FkZHJfdCBk
bWE7Ci0KLQlmb3IgKGkgPSAwOyBpIDwgdW1lbS0+bnBnczsgaSsrKSB7Ci0JCWRtYSA9IGRtYV9t
YXBfcGFnZV9hdHRycyhkZXYsIHVtZW0tPnBnc1tpXSwgMCwgUEFHRV9TSVpFLAotCQkJCQkgRE1B
X0JJRElSRUNUSU9OQUwsIElYR0JFX1JYX0RNQV9BVFRSKTsKLQkJaWYgKGRtYV9tYXBwaW5nX2Vy
cm9yKGRldiwgZG1hKSkKLQkJCWdvdG8gb3V0X3VubWFwOwotCi0JCXVtZW0tPnBhZ2VzW2ldLmRt
YSA9IGRtYTsKLQl9Ci0KLQlyZXR1cm4gMDsKLQotb3V0X3VubWFwOgotCWZvciAoaiA9IDA7IGog
PCBpOyBqKyspIHsKLQkJZG1hX3VubWFwX3BhZ2VfYXR0cnMoZGV2LCB1bWVtLT5wYWdlc1tpXS5k
bWEsIFBBR0VfU0laRSwKLQkJCQkgICAgIERNQV9CSURJUkVDVElPTkFMLCBJWEdCRV9SWF9ETUFf
QVRUUik7Ci0JCXVtZW0tPnBhZ2VzW2ldLmRtYSA9IDA7Ci0JfQotCi0JcmV0dXJuIC0xOwotfQot
Ci1zdGF0aWMgdm9pZCBpeGdiZV94c2tfdW1lbV9kbWFfdW5tYXAoc3RydWN0IGl4Z2JlX2FkYXB0
ZXIgKmFkYXB0ZXIsCi0JCQkJICAgICBzdHJ1Y3QgeGRwX3VtZW0gKnVtZW0pCi17Ci0Jc3RydWN0
IGRldmljZSAqZGV2ID0gJmFkYXB0ZXItPnBkZXYtPmRldjsKLQl1bnNpZ25lZCBpbnQgaTsKLQot
CWZvciAoaSA9IDA7IGkgPCB1bWVtLT5ucGdzOyBpKyspIHsKLQkJZG1hX3VubWFwX3BhZ2VfYXR0
cnMoZGV2LCB1bWVtLT5wYWdlc1tpXS5kbWEsIFBBR0VfU0laRSwKLQkJCQkgICAgIERNQV9CSURJ
UkVDVElPTkFMLCBJWEdCRV9SWF9ETUFfQVRUUik7Ci0KLQkJdW1lbS0+cGFnZXNbaV0uZG1hID0g
MDsKLQl9Ci19Ci0KIHN0YXRpYyBpbnQgaXhnYmVfeHNrX3VtZW1fZW5hYmxlKHN0cnVjdCBpeGdi
ZV9hZGFwdGVyICphZGFwdGVyLAogCQkJCSBzdHJ1Y3QgeGRwX3VtZW0gKnVtZW0sCiAJCQkJIHUx
NiBxaWQpCiB7CiAJc3RydWN0IG5ldF9kZXZpY2UgKm5ldGRldiA9IGFkYXB0ZXItPm5ldGRldjsK
LQlzdHJ1Y3QgeGRwX3VtZW1fZnFfcmV1c2UgKnJldXNlcTsKIAlib29sIGlmX3J1bm5pbmc7CiAJ
aW50IGVycjsKIApAQCAtNzgsMTMgKzM1LDcgQEAgc3RhdGljIGludCBpeGdiZV94c2tfdW1lbV9l
bmFibGUoc3RydWN0IGl4Z2JlX2FkYXB0ZXIgKmFkYXB0ZXIsCiAJICAgIHFpZCA+PSBuZXRkZXYt
PnJlYWxfbnVtX3R4X3F1ZXVlcykKIAkJcmV0dXJuIC1FSU5WQUw7CiAKLQlyZXVzZXEgPSB4c2tf
cmV1c2VxX3ByZXBhcmUoYWRhcHRlci0+cnhfcmluZ1swXS0+Y291bnQpOwotCWlmICghcmV1c2Vx
KQotCQlyZXR1cm4gLUVOT01FTTsKLQotCXhza19yZXVzZXFfZnJlZSh4c2tfcmV1c2VxX3N3YXAo
dW1lbSwgcmV1c2VxKSk7Ci0KLQllcnIgPSBpeGdiZV94c2tfdW1lbV9kbWFfbWFwKGFkYXB0ZXIs
IHVtZW0pOworCWVyciA9IHhza19idWZmX2RtYV9tYXAodW1lbSwgJmFkYXB0ZXItPnBkZXYtPmRl
diwgSVhHQkVfUlhfRE1BX0FUVFIpOwogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CiAKQEAgLTEy
NCw3ICs3NSw3IEBAIHN0YXRpYyBpbnQgaXhnYmVfeHNrX3VtZW1fZGlzYWJsZShzdHJ1Y3QgaXhn
YmVfYWRhcHRlciAqYWRhcHRlciwgdTE2IHFpZCkKIAkJaXhnYmVfdHhyeF9yaW5nX2Rpc2FibGUo
YWRhcHRlciwgcWlkKTsKIAogCWNsZWFyX2JpdChxaWQsIGFkYXB0ZXItPmFmX3hkcF96Y19xcHMp
OwotCWl4Z2JlX3hza191bWVtX2RtYV91bm1hcChhZGFwdGVyLCB1bWVtKTsKKwl4c2tfYnVmZl9k
bWFfdW5tYXAodW1lbSwgSVhHQkVfUlhfRE1BX0FUVFIpOwogCiAJaWYgKGlmX3J1bm5pbmcpCiAJ
CWl4Z2JlX3R4cnhfcmluZ19lbmFibGUoYWRhcHRlciwgcWlkKTsKQEAgLTE0MywxOSArOTQsMTQg
QEAgc3RhdGljIGludCBpeGdiZV9ydW5feGRwX3pjKHN0cnVjdCBpeGdiZV9hZGFwdGVyICphZGFw
dGVyLAogCQkJICAgIHN0cnVjdCBpeGdiZV9yaW5nICpyeF9yaW5nLAogCQkJICAgIHN0cnVjdCB4
ZHBfYnVmZiAqeGRwKQogewotCXN0cnVjdCB4ZHBfdW1lbSAqdW1lbSA9IHJ4X3JpbmctPnhza191
bWVtOwogCWludCBlcnIsIHJlc3VsdCA9IElYR0JFX1hEUF9QQVNTOwogCXN0cnVjdCBicGZfcHJv
ZyAqeGRwX3Byb2c7CiAJc3RydWN0IHhkcF9mcmFtZSAqeGRwZjsKLQl1NjQgb2Zmc2V0OwogCXUz
MiBhY3Q7CiAKIAlyY3VfcmVhZF9sb2NrKCk7CiAJeGRwX3Byb2cgPSBSRUFEX09OQ0Uocnhfcmlu
Zy0+eGRwX3Byb2cpOwogCWFjdCA9IGJwZl9wcm9nX3J1bl94ZHAoeGRwX3Byb2csIHhkcCk7Ci0J
b2Zmc2V0ID0geGRwLT5kYXRhIC0geGRwLT5kYXRhX2hhcmRfc3RhcnQ7Ci0KLQl4ZHAtPmhhbmRs
ZSA9IHhza191bWVtX2FkanVzdF9vZmZzZXQodW1lbSwgeGRwLT5oYW5kbGUsIG9mZnNldCk7CiAK
IAlzd2l0Y2ggKGFjdCkgewogCWNhc2UgWERQX1BBU1M6CkBAIC0xODYsMTQwICsxMzIsMTYgQEAg
c3RhdGljIGludCBpeGdiZV9ydW5feGRwX3pjKHN0cnVjdCBpeGdiZV9hZGFwdGVyICphZGFwdGVy
LAogCXJldHVybiByZXN1bHQ7CiB9CiAKLXN0YXRpYyBzdHJ1Y3QKLWl4Z2JlX3J4X2J1ZmZlciAq
aXhnYmVfZ2V0X3J4X2J1ZmZlcl96YyhzdHJ1Y3QgaXhnYmVfcmluZyAqcnhfcmluZywKLQkJCQkJ
dW5zaWduZWQgaW50IHNpemUpCi17Ci0Jc3RydWN0IGl4Z2JlX3J4X2J1ZmZlciAqYmk7Ci0KLQli
aSA9ICZyeF9yaW5nLT5yeF9idWZmZXJfaW5mb1tyeF9yaW5nLT5uZXh0X3RvX2NsZWFuXTsKLQot
CS8qIHdlIGFyZSByZXVzaW5nIHNvIHN5bmMgdGhpcyBidWZmZXIgZm9yIENQVSB1c2UgKi8KLQlk
bWFfc3luY19zaW5nbGVfcmFuZ2VfZm9yX2NwdShyeF9yaW5nLT5kZXYsCi0JCQkJICAgICAgYmkt
PmRtYSwgMCwKLQkJCQkgICAgICBzaXplLAotCQkJCSAgICAgIERNQV9CSURJUkVDVElPTkFMKTsK
LQotCXJldHVybiBiaTsKLX0KLQotc3RhdGljIHZvaWQgaXhnYmVfcmV1c2VfcnhfYnVmZmVyX3pj
KHN0cnVjdCBpeGdiZV9yaW5nICpyeF9yaW5nLAotCQkJCSAgICAgc3RydWN0IGl4Z2JlX3J4X2J1
ZmZlciAqb2JpKQotewotCXUxNiBudGEgPSByeF9yaW5nLT5uZXh0X3RvX2FsbG9jOwotCXN0cnVj
dCBpeGdiZV9yeF9idWZmZXIgKm5iaTsKLQotCW5iaSA9ICZyeF9yaW5nLT5yeF9idWZmZXJfaW5m
b1tyeF9yaW5nLT5uZXh0X3RvX2FsbG9jXTsKLQkvKiB1cGRhdGUsIGFuZCBzdG9yZSBuZXh0IHRv
IGFsbG9jICovCi0JbnRhKys7Ci0JcnhfcmluZy0+bmV4dF90b19hbGxvYyA9IChudGEgPCByeF9y
aW5nLT5jb3VudCkgPyBudGEgOiAwOwotCi0JLyogdHJhbnNmZXIgcGFnZSBmcm9tIG9sZCBidWZm
ZXIgdG8gbmV3IGJ1ZmZlciAqLwotCW5iaS0+ZG1hID0gb2JpLT5kbWE7Ci0JbmJpLT5hZGRyID0g
b2JpLT5hZGRyOwotCW5iaS0+aGFuZGxlID0gb2JpLT5oYW5kbGU7Ci0KLQlvYmktPmFkZHIgPSBO
VUxMOwotCW9iaS0+c2tiID0gTlVMTDsKLX0KLQotdm9pZCBpeGdiZV96Y2FfZnJlZShzdHJ1Y3Qg
emVyb19jb3B5X2FsbG9jYXRvciAqYWxsb2MsIHVuc2lnbmVkIGxvbmcgaGFuZGxlKQotewotCXN0
cnVjdCBpeGdiZV9yeF9idWZmZXIgKmJpOwotCXN0cnVjdCBpeGdiZV9yaW5nICpyeF9yaW5nOwot
CXU2NCBociwgbWFzazsKLQl1MTYgbnRhOwotCi0JcnhfcmluZyA9IGNvbnRhaW5lcl9vZihhbGxv
Yywgc3RydWN0IGl4Z2JlX3JpbmcsIHpjYSk7Ci0JaHIgPSByeF9yaW5nLT54c2tfdW1lbS0+aGVh
ZHJvb20gKyBYRFBfUEFDS0VUX0hFQURST09NOwotCW1hc2sgPSByeF9yaW5nLT54c2tfdW1lbS0+
Y2h1bmtfbWFzazsKLQotCW50YSA9IHJ4X3JpbmctPm5leHRfdG9fYWxsb2M7Ci0JYmkgPSByeF9y
aW5nLT5yeF9idWZmZXJfaW5mbzsKLQotCW50YSsrOwotCXJ4X3JpbmctPm5leHRfdG9fYWxsb2Mg
PSAobnRhIDwgcnhfcmluZy0+Y291bnQpID8gbnRhIDogMDsKLQotCWhhbmRsZSAmPSBtYXNrOwot
Ci0JYmktPmRtYSA9IHhkcF91bWVtX2dldF9kbWEocnhfcmluZy0+eHNrX3VtZW0sIGhhbmRsZSk7
Ci0JYmktPmRtYSArPSBocjsKLQotCWJpLT5hZGRyID0geGRwX3VtZW1fZ2V0X2RhdGEocnhfcmlu
Zy0+eHNrX3VtZW0sIGhhbmRsZSk7Ci0JYmktPmFkZHIgKz0gaHI7Ci0KLQliaS0+aGFuZGxlID0g
eHNrX3VtZW1fYWRqdXN0X29mZnNldChyeF9yaW5nLT54c2tfdW1lbSwgKHU2NCloYW5kbGUsCi0J
CQkJCSAgICByeF9yaW5nLT54c2tfdW1lbS0+aGVhZHJvb20pOwotfQotCi1zdGF0aWMgYm9vbCBp
eGdiZV9hbGxvY19idWZmZXJfemMoc3RydWN0IGl4Z2JlX3JpbmcgKnJ4X3JpbmcsCi0JCQkJICBz
dHJ1Y3QgaXhnYmVfcnhfYnVmZmVyICpiaSkKLXsKLQlzdHJ1Y3QgeGRwX3VtZW0gKnVtZW0gPSBy
eF9yaW5nLT54c2tfdW1lbTsKLQl2b2lkICphZGRyID0gYmktPmFkZHI7Ci0JdTY0IGhhbmRsZSwg
aHI7Ci0KLQlpZiAoYWRkcikKLQkJcmV0dXJuIHRydWU7Ci0KLQlpZiAoIXhza191bWVtX3BlZWtf
YWRkcih1bWVtLCAmaGFuZGxlKSkgewotCQlyeF9yaW5nLT5yeF9zdGF0cy5hbGxvY19yeF9wYWdl
X2ZhaWxlZCsrOwotCQlyZXR1cm4gZmFsc2U7Ci0JfQotCi0JaHIgPSB1bWVtLT5oZWFkcm9vbSAr
IFhEUF9QQUNLRVRfSEVBRFJPT007Ci0KLQliaS0+ZG1hID0geGRwX3VtZW1fZ2V0X2RtYSh1bWVt
LCBoYW5kbGUpOwotCWJpLT5kbWEgKz0gaHI7Ci0KLQliaS0+YWRkciA9IHhkcF91bWVtX2dldF9k
YXRhKHVtZW0sIGhhbmRsZSk7Ci0JYmktPmFkZHIgKz0gaHI7Ci0KLQliaS0+aGFuZGxlID0geHNr
X3VtZW1fYWRqdXN0X29mZnNldCh1bWVtLCBoYW5kbGUsIHVtZW0tPmhlYWRyb29tKTsKLQotCXhz
a191bWVtX3JlbGVhc2VfYWRkcih1bWVtKTsKLQlyZXR1cm4gdHJ1ZTsKLX0KLQotc3RhdGljIGJv
b2wgaXhnYmVfYWxsb2NfYnVmZmVyX3Nsb3dfemMoc3RydWN0IGl4Z2JlX3JpbmcgKnJ4X3Jpbmcs
Ci0JCQkJICAgICAgIHN0cnVjdCBpeGdiZV9yeF9idWZmZXIgKmJpKQotewotCXN0cnVjdCB4ZHBf
dW1lbSAqdW1lbSA9IHJ4X3JpbmctPnhza191bWVtOwotCXU2NCBoYW5kbGUsIGhyOwotCi0JaWYg
KCF4c2tfdW1lbV9wZWVrX2FkZHJfcnEodW1lbSwgJmhhbmRsZSkpIHsKLQkJcnhfcmluZy0+cnhf
c3RhdHMuYWxsb2NfcnhfcGFnZV9mYWlsZWQrKzsKLQkJcmV0dXJuIGZhbHNlOwotCX0KLQotCWhh
bmRsZSAmPSByeF9yaW5nLT54c2tfdW1lbS0+Y2h1bmtfbWFzazsKLQotCWhyID0gdW1lbS0+aGVh
ZHJvb20gKyBYRFBfUEFDS0VUX0hFQURST09NOwotCi0JYmktPmRtYSA9IHhkcF91bWVtX2dldF9k
bWEodW1lbSwgaGFuZGxlKTsKLQliaS0+ZG1hICs9IGhyOwotCi0JYmktPmFkZHIgPSB4ZHBfdW1l
bV9nZXRfZGF0YSh1bWVtLCBoYW5kbGUpOwotCWJpLT5hZGRyICs9IGhyOwotCi0JYmktPmhhbmRs
ZSA9IHhza191bWVtX2FkanVzdF9vZmZzZXQodW1lbSwgaGFuZGxlLCB1bWVtLT5oZWFkcm9vbSk7
Ci0KLQl4c2tfdW1lbV9yZWxlYXNlX2FkZHJfcnEodW1lbSk7Ci0JcmV0dXJuIHRydWU7Ci19Ci0K
LXN0YXRpYyBfX2Fsd2F5c19pbmxpbmUgYm9vbAotX19peGdiZV9hbGxvY19yeF9idWZmZXJzX3pj
KHN0cnVjdCBpeGdiZV9yaW5nICpyeF9yaW5nLCB1MTYgY2xlYW5lZF9jb3VudCwKLQkJCSAgICBi
b29sIGFsbG9jKHN0cnVjdCBpeGdiZV9yaW5nICpyeF9yaW5nLAotCQkJCSAgICAgICBzdHJ1Y3Qg
aXhnYmVfcnhfYnVmZmVyICpiaSkpCitib29sIGl4Z2JlX2FsbG9jX3J4X2J1ZmZlcnNfemMoc3Ry
dWN0IGl4Z2JlX3JpbmcgKnJ4X3JpbmcsIHUxNiBjb3VudCkKIHsKIAl1bmlvbiBpeGdiZV9hZHZf
cnhfZGVzYyAqcnhfZGVzYzsKIAlzdHJ1Y3QgaXhnYmVfcnhfYnVmZmVyICpiaTsKIAl1MTYgaSA9
IHJ4X3JpbmctPm5leHRfdG9fdXNlOworCWRtYV9hZGRyX3QgZG1hOwogCWJvb2wgb2sgPSB0cnVl
OwogCiAJLyogbm90aGluZyB0byBkbyAqLwotCWlmICghY2xlYW5lZF9jb3VudCkKKwlpZiAoIWNv
dW50KQogCQlyZXR1cm4gdHJ1ZTsKIAogCXJ4X2Rlc2MgPSBJWEdCRV9SWF9ERVNDKHJ4X3Jpbmcs
IGkpOwpAQCAtMzI3LDIxICsxNDksMTggQEAgX19peGdiZV9hbGxvY19yeF9idWZmZXJzX3pjKHN0
cnVjdCBpeGdiZV9yaW5nICpyeF9yaW5nLCB1MTYgY2xlYW5lZF9jb3VudCwKIAlpIC09IHJ4X3Jp
bmctPmNvdW50OwogCiAJZG8gewotCQlpZiAoIWFsbG9jKHJ4X3JpbmcsIGJpKSkgeworCQliaS0+
eGRwID0geHNrX2J1ZmZfYWxsb2MocnhfcmluZy0+eHNrX3VtZW0pOworCQlpZiAoIWJpLT54ZHAp
IHsKIAkJCW9rID0gZmFsc2U7CiAJCQlicmVhazsKIAkJfQogCi0JCS8qIHN5bmMgdGhlIGJ1ZmZl
ciBmb3IgdXNlIGJ5IHRoZSBkZXZpY2UgKi8KLQkJZG1hX3N5bmNfc2luZ2xlX3JhbmdlX2Zvcl9k
ZXZpY2UocnhfcmluZy0+ZGV2LCBiaS0+ZG1hLAotCQkJCQkJIGJpLT5wYWdlX29mZnNldCwKLQkJ
CQkJCSByeF9yaW5nLT5yeF9idWZfbGVuLAotCQkJCQkJIERNQV9CSURJUkVDVElPTkFMKTsKKwkJ
ZG1hID0geHNrX2J1ZmZfeGRwX2dldF9kbWEoYmktPnhkcCk7CiAKIAkJLyogUmVmcmVzaCB0aGUg
ZGVzYyBldmVuIGlmIGJ1ZmZlcl9hZGRycyBkaWRuJ3QgY2hhbmdlCiAJCSAqIGJlY2F1c2UgZWFj
aCB3cml0ZS1iYWNrIGVyYXNlcyB0aGlzIGluZm8uCiAJCSAqLwotCQlyeF9kZXNjLT5yZWFkLnBr
dF9hZGRyID0gY3B1X3RvX2xlNjQoYmktPmRtYSk7CisJCXJ4X2Rlc2MtPnJlYWQucGt0X2FkZHIg
PSBjcHVfdG9fbGU2NChkbWEpOwogCiAJCXJ4X2Rlc2MrKzsKIAkJYmkrKzsKQEAgLTM1NSwxNyAr
MTc0LDE0IEBAIF9faXhnYmVfYWxsb2NfcnhfYnVmZmVyc196YyhzdHJ1Y3QgaXhnYmVfcmluZyAq
cnhfcmluZywgdTE2IGNsZWFuZWRfY291bnQsCiAJCS8qIGNsZWFyIHRoZSBsZW5ndGggZm9yIHRo
ZSBuZXh0X3RvX3VzZSBkZXNjcmlwdG9yICovCiAJCXJ4X2Rlc2MtPndiLnVwcGVyLmxlbmd0aCA9
IDA7CiAKLQkJY2xlYW5lZF9jb3VudC0tOwotCX0gd2hpbGUgKGNsZWFuZWRfY291bnQpOworCQlj
b3VudC0tOworCX0gd2hpbGUgKGNvdW50KTsKIAogCWkgKz0gcnhfcmluZy0+Y291bnQ7CiAKIAlp
ZiAocnhfcmluZy0+bmV4dF90b191c2UgIT0gaSkgewogCQlyeF9yaW5nLT5uZXh0X3RvX3VzZSA9
IGk7CiAKLQkJLyogdXBkYXRlIG5leHQgdG8gYWxsb2Mgc2luY2Ugd2UgaGF2ZSBmaWxsZWQgdGhl
IHJpbmcgKi8KLQkJcnhfcmluZy0+bmV4dF90b19hbGxvYyA9IGk7Ci0KIAkJLyogRm9yY2UgbWVt
b3J5IHdyaXRlcyB0byBjb21wbGV0ZSBiZWZvcmUgbGV0dGluZyBoL3cKIAkJICoga25vdyB0aGVy
ZSBhcmUgbmV3IGRlc2NyaXB0b3JzIHRvIGZldGNoLiAgKE9ubHkKIAkJICogYXBwbGljYWJsZSBm
b3Igd2Vhay1vcmRlcmVkIG1lbW9yeSBtb2RlbCBhcmNocywKQEAgLTM3OCw0MCArMTk0LDI3IEBA
IF9faXhnYmVfYWxsb2NfcnhfYnVmZmVyc196YyhzdHJ1Y3QgaXhnYmVfcmluZyAqcnhfcmluZywg
dTE2IGNsZWFuZWRfY291bnQsCiAJcmV0dXJuIG9rOwogfQogCi12b2lkIGl4Z2JlX2FsbG9jX3J4
X2J1ZmZlcnNfemMoc3RydWN0IGl4Z2JlX3JpbmcgKnJ4X3JpbmcsIHUxNiBjb3VudCkKLXsKLQlf
X2l4Z2JlX2FsbG9jX3J4X2J1ZmZlcnNfemMocnhfcmluZywgY291bnQsCi0JCQkJICAgIGl4Z2Jl
X2FsbG9jX2J1ZmZlcl9zbG93X3pjKTsKLX0KLQotc3RhdGljIGJvb2wgaXhnYmVfYWxsb2Nfcnhf
YnVmZmVyc19mYXN0X3pjKHN0cnVjdCBpeGdiZV9yaW5nICpyeF9yaW5nLAotCQkJCQkgICB1MTYg
Y291bnQpCi17Ci0JcmV0dXJuIF9faXhnYmVfYWxsb2NfcnhfYnVmZmVyc196YyhyeF9yaW5nLCBj
b3VudCwKLQkJCQkJICAgaXhnYmVfYWxsb2NfYnVmZmVyX3pjKTsKLX0KLQogc3RhdGljIHN0cnVj
dCBza19idWZmICppeGdiZV9jb25zdHJ1Y3Rfc2tiX3pjKHN0cnVjdCBpeGdiZV9yaW5nICpyeF9y
aW5nLAotCQkJCQkgICAgICBzdHJ1Y3QgaXhnYmVfcnhfYnVmZmVyICpiaSwKLQkJCQkJICAgICAg
c3RydWN0IHhkcF9idWZmICp4ZHApCisJCQkJCSAgICAgIHN0cnVjdCBpeGdiZV9yeF9idWZmZXIg
KmJpKQogewotCXVuc2lnbmVkIGludCBtZXRhc2l6ZSA9IHhkcC0+ZGF0YSAtIHhkcC0+ZGF0YV9t
ZXRhOwotCXVuc2lnbmVkIGludCBkYXRhc2l6ZSA9IHhkcC0+ZGF0YV9lbmQgLSB4ZHAtPmRhdGE7
CisJdW5zaWduZWQgaW50IG1ldGFzaXplID0gYmktPnhkcC0+ZGF0YSAtIGJpLT54ZHAtPmRhdGFf
bWV0YTsKKwl1bnNpZ25lZCBpbnQgZGF0YXNpemUgPSBiaS0+eGRwLT5kYXRhX2VuZCAtIGJpLT54
ZHAtPmRhdGE7CiAJc3RydWN0IHNrX2J1ZmYgKnNrYjsKIAogCS8qIGFsbG9jYXRlIGEgc2tiIHRv
IHN0b3JlIHRoZSBmcmFncyAqLwogCXNrYiA9IF9fbmFwaV9hbGxvY19za2IoJnJ4X3JpbmctPnFf
dmVjdG9yLT5uYXBpLAotCQkJICAgICAgIHhkcC0+ZGF0YV9lbmQgLSB4ZHAtPmRhdGFfaGFyZF9z
dGFydCwKKwkJCSAgICAgICBiaS0+eGRwLT5kYXRhX2VuZCAtIGJpLT54ZHAtPmRhdGFfaGFyZF9z
dGFydCwKIAkJCSAgICAgICBHRlBfQVRPTUlDIHwgX19HRlBfTk9XQVJOKTsKIAlpZiAodW5saWtl
bHkoIXNrYikpCiAJCXJldHVybiBOVUxMOwogCi0Jc2tiX3Jlc2VydmUoc2tiLCB4ZHAtPmRhdGEg
LSB4ZHAtPmRhdGFfaGFyZF9zdGFydCk7Ci0JbWVtY3B5KF9fc2tiX3B1dChza2IsIGRhdGFzaXpl
KSwgeGRwLT5kYXRhLCBkYXRhc2l6ZSk7CisJc2tiX3Jlc2VydmUoc2tiLCBiaS0+eGRwLT5kYXRh
IC0gYmktPnhkcC0+ZGF0YV9oYXJkX3N0YXJ0KTsKKwltZW1jcHkoX19za2JfcHV0KHNrYiwgZGF0
YXNpemUpLCBiaS0+eGRwLT5kYXRhLCBkYXRhc2l6ZSk7CiAJaWYgKG1ldGFzaXplKQogCQlza2Jf
bWV0YWRhdGFfc2V0KHNrYiwgbWV0YXNpemUpOwogCi0JaXhnYmVfcmV1c2VfcnhfYnVmZmVyX3pj
KHJ4X3JpbmcsIGJpKTsKKwl4c2tfYnVmZl9mcmVlKGJpLT54ZHApOworCWJpLT54ZHAgPSBOVUxM
OwogCXJldHVybiBza2I7CiB9CiAKQEAgLTQzNCw5ICsyMzcsNiBAQCBpbnQgaXhnYmVfY2xlYW5f
cnhfaXJxX3pjKHN0cnVjdCBpeGdiZV9xX3ZlY3RvciAqcV92ZWN0b3IsCiAJdW5zaWduZWQgaW50
IHhkcF9yZXMsIHhkcF94bWl0ID0gMDsKIAlib29sIGZhaWx1cmUgPSBmYWxzZTsKIAlzdHJ1Y3Qg
c2tfYnVmZiAqc2tiOwotCXN0cnVjdCB4ZHBfYnVmZiB4ZHA7Ci0KLQl4ZHAucnhxID0gJnJ4X3Jp
bmctPnhkcF9yeHE7CiAKIAl3aGlsZSAobGlrZWx5KHRvdGFsX3J4X3BhY2tldHMgPCBidWRnZXQp
KSB7CiAJCXVuaW9uIGl4Z2JlX2Fkdl9yeF9kZXNjICpyeF9kZXNjOwpAQCAtNDQ2LDggKzI0Niw4
IEBAIGludCBpeGdiZV9jbGVhbl9yeF9pcnFfemMoc3RydWN0IGl4Z2JlX3FfdmVjdG9yICpxX3Zl
Y3RvciwKIAkJLyogcmV0dXJuIHNvbWUgYnVmZmVycyB0byBoYXJkd2FyZSwgb25lIGF0IGEgdGlt
ZSBpcyB0b28gc2xvdyAqLwogCQlpZiAoY2xlYW5lZF9jb3VudCA+PSBJWEdCRV9SWF9CVUZGRVJf
V1JJVEUpIHsKIAkJCWZhaWx1cmUgPSBmYWlsdXJlIHx8Ci0JCQkJICAhaXhnYmVfYWxsb2Nfcnhf
YnVmZmVyc19mYXN0X3pjKHJ4X3JpbmcsCi0JCQkJCQkJCSBjbGVhbmVkX2NvdW50KTsKKwkJCQkg
ICFpeGdiZV9hbGxvY19yeF9idWZmZXJzX3pjKHJ4X3JpbmcsCisJCQkJCQkJICAgICBjbGVhbmVk
X2NvdW50KTsKIAkJCWNsZWFuZWRfY291bnQgPSAwOwogCQl9CiAKQEAgLTQ2Miw0MiArMjYyLDQw
IEBAIGludCBpeGdiZV9jbGVhbl9yeF9pcnFfemMoc3RydWN0IGl4Z2JlX3FfdmVjdG9yICpxX3Zl
Y3RvciwKIAkJICovCiAJCWRtYV9ybWIoKTsKIAotCQliaSA9IGl4Z2JlX2dldF9yeF9idWZmZXJf
emMocnhfcmluZywgc2l6ZSk7CisJCWJpID0gJnJ4X3JpbmctPnJ4X2J1ZmZlcl9pbmZvW3J4X3Jp
bmctPm5leHRfdG9fY2xlYW5dOwogCiAJCWlmICh1bmxpa2VseSghaXhnYmVfdGVzdF9zdGF0ZXJy
KHJ4X2Rlc2MsCiAJCQkJCQkgSVhHQkVfUlhEX1NUQVRfRU9QKSkpIHsKIAkJCXN0cnVjdCBpeGdi
ZV9yeF9idWZmZXIgKm5leHRfYmk7CiAKLQkJCWl4Z2JlX3JldXNlX3J4X2J1ZmZlcl96YyhyeF9y
aW5nLCBiaSk7CisJCQl4c2tfYnVmZl9mcmVlKGJpLT54ZHApOworCQkJYmktPnhkcCA9IE5VTEw7
CiAJCQlpeGdiZV9pbmNfbnRjKHJ4X3JpbmcpOwogCQkJbmV4dF9iaSA9CiAJCQkgICAgICAgJnJ4
X3JpbmctPnJ4X2J1ZmZlcl9pbmZvW3J4X3JpbmctPm5leHRfdG9fY2xlYW5dOwotCQkJbmV4dF9i
aS0+c2tiID0gRVJSX1BUUigtRUlOVkFMKTsKKwkJCW5leHRfYmktPmRpc2NhcmQgPSB0cnVlOwog
CQkJY29udGludWU7CiAJCX0KIAotCQlpZiAodW5saWtlbHkoYmktPnNrYikpIHsKLQkJCWl4Z2Jl
X3JldXNlX3J4X2J1ZmZlcl96YyhyeF9yaW5nLCBiaSk7CisJCWlmICh1bmxpa2VseShiaS0+ZGlz
Y2FyZCkpIHsKKwkJCXhza19idWZmX2ZyZWUoYmktPnhkcCk7CisJCQliaS0+eGRwID0gTlVMTDsK
KwkJCWJpLT5kaXNjYXJkID0gZmFsc2U7CiAJCQlpeGdiZV9pbmNfbnRjKHJ4X3JpbmcpOwogCQkJ
Y29udGludWU7CiAJCX0KIAotCQl4ZHAuZGF0YSA9IGJpLT5hZGRyOwotCQl4ZHAuZGF0YV9tZXRh
ID0geGRwLmRhdGE7Ci0JCXhkcC5kYXRhX2hhcmRfc3RhcnQgPSB4ZHAuZGF0YSAtIFhEUF9QQUNL
RVRfSEVBRFJPT007Ci0JCXhkcC5kYXRhX2VuZCA9IHhkcC5kYXRhICsgc2l6ZTsKLQkJeGRwLmhh
bmRsZSA9IGJpLT5oYW5kbGU7Ci0KLQkJeGRwX3JlcyA9IGl4Z2JlX3J1bl94ZHBfemMoYWRhcHRl
ciwgcnhfcmluZywgJnhkcCk7CisJCWJpLT54ZHAtPmRhdGFfZW5kID0gYmktPnhkcC0+ZGF0YV9l
bmQgKyBzaXplOworCQl4c2tfYnVmZl9kbWFfc3luY19mb3JfY3B1KGJpLT54ZHApOworCQl4ZHBf
cmVzID0gaXhnYmVfcnVuX3hkcF96YyhhZGFwdGVyLCByeF9yaW5nLCBiaS0+eGRwKTsKIAogCQlp
ZiAoeGRwX3JlcykgewotCQkJaWYgKHhkcF9yZXMgJiAoSVhHQkVfWERQX1RYIHwgSVhHQkVfWERQ
X1JFRElSKSkgeworCQkJaWYgKHhkcF9yZXMgJiAoSVhHQkVfWERQX1RYIHwgSVhHQkVfWERQX1JF
RElSKSkKIAkJCQl4ZHBfeG1pdCB8PSB4ZHBfcmVzOwotCQkJCWJpLT5hZGRyID0gTlVMTDsKLQkJ
CQliaS0+c2tiID0gTlVMTDsKLQkJCX0gZWxzZSB7Ci0JCQkJaXhnYmVfcmV1c2VfcnhfYnVmZmVy
X3pjKHJ4X3JpbmcsIGJpKTsKLQkJCX0KKwkJCWVsc2UKKwkJCQl4c2tfYnVmZl9mcmVlKGJpLT54
ZHApOworCisJCQliaS0+eGRwID0gTlVMTDsKIAkJCXRvdGFsX3J4X3BhY2tldHMrKzsKIAkJCXRv
dGFsX3J4X2J5dGVzICs9IHNpemU7CiAKQEAgLTUwNyw3ICszMDUsNyBAQCBpbnQgaXhnYmVfY2xl
YW5fcnhfaXJxX3pjKHN0cnVjdCBpeGdiZV9xX3ZlY3RvciAqcV92ZWN0b3IsCiAJCX0KIAogCQkv
KiBYRFBfUEFTUyBwYXRoICovCi0JCXNrYiA9IGl4Z2JlX2NvbnN0cnVjdF9za2JfemMocnhfcmlu
ZywgYmksICZ4ZHApOworCQlza2IgPSBpeGdiZV9jb25zdHJ1Y3Rfc2tiX3pjKHJ4X3JpbmcsIGJp
KTsKIAkJaWYgKCFza2IpIHsKIAkJCXJ4X3JpbmctPnJ4X3N0YXRzLmFsbG9jX3J4X2J1ZmZfZmFp
bGVkKys7CiAJCQlicmVhazsKQEAgLTU1OSwxNyArMzU3LDE3IEBAIGludCBpeGdiZV9jbGVhbl9y
eF9pcnFfemMoc3RydWN0IGl4Z2JlX3FfdmVjdG9yICpxX3ZlY3RvciwKIAogdm9pZCBpeGdiZV94
c2tfY2xlYW5fcnhfcmluZyhzdHJ1Y3QgaXhnYmVfcmluZyAqcnhfcmluZykKIHsKLQl1MTYgaSA9
IHJ4X3JpbmctPm5leHRfdG9fY2xlYW47Ci0Jc3RydWN0IGl4Z2JlX3J4X2J1ZmZlciAqYmkgPSAm
cnhfcmluZy0+cnhfYnVmZmVyX2luZm9baV07CisJc3RydWN0IGl4Z2JlX3J4X2J1ZmZlciAqYmk7
CisJdTE2IGk7CiAKLQl3aGlsZSAoaSAhPSByeF9yaW5nLT5uZXh0X3RvX2FsbG9jKSB7Ci0JCXhz
a191bWVtX2ZxX3JldXNlKHJ4X3JpbmctPnhza191bWVtLCBiaS0+aGFuZGxlKTsKLQkJaSsrOwot
CQliaSsrOwotCQlpZiAoaSA9PSByeF9yaW5nLT5jb3VudCkgewotCQkJaSA9IDA7Ci0JCQliaSA9
IHJ4X3JpbmctPnJ4X2J1ZmZlcl9pbmZvOwotCQl9CisJZm9yIChpID0gMDsgaSA8IHJ4X3Jpbmct
PmNvdW50OyBpKyspIHsKKwkJYmkgPSAmcnhfcmluZy0+cnhfYnVmZmVyX2luZm9baV07CisKKwkJ
aWYgKCFiaS0+eGRwKQorCQkJY29udGludWU7CisKKwkJeHNrX2J1ZmZfZnJlZShiaS0+eGRwKTsK
KwkJYmktPnhkcCA9IE5VTEw7CiAJfQogfQogCkBAIC01OTIsMTAgKzM5MCw5IEBAIHN0YXRpYyBi
b29sIGl4Z2JlX3htaXRfemMoc3RydWN0IGl4Z2JlX3JpbmcgKnhkcF9yaW5nLCB1bnNpZ25lZCBp
bnQgYnVkZ2V0KQogCQlpZiAoIXhza191bWVtX2NvbnN1bWVfdHgoeGRwX3JpbmctPnhza191bWVt
LCAmZGVzYykpCiAJCQlicmVhazsKIAotCQlkbWEgPSB4ZHBfdW1lbV9nZXRfZG1hKHhkcF9yaW5n
LT54c2tfdW1lbSwgZGVzYy5hZGRyKTsKLQotCQlkbWFfc3luY19zaW5nbGVfZm9yX2RldmljZSh4
ZHBfcmluZy0+ZGV2LCBkbWEsIGRlc2MubGVuLAotCQkJCQkgICBETUFfQklESVJFQ1RJT05BTCk7
CisJCWRtYSA9IHhza19idWZmX3Jhd19nZXRfZG1hKHhkcF9yaW5nLT54c2tfdW1lbSwgZGVzYy5h
ZGRyKTsKKwkJeHNrX2J1ZmZfcmF3X2RtYV9zeW5jX2Zvcl9kZXZpY2UoeGRwX3JpbmctPnhza191
bWVtLCBkbWEsCisJCQkJCQkgZGVzYy5sZW4pOwogCiAJCXR4X2JpID0gJnhkcF9yaW5nLT50eF9i
dWZmZXJfaW5mb1t4ZHBfcmluZy0+bmV4dF90b191c2VdOwogCQl0eF9iaS0+Ynl0ZWNvdW50ID0g
ZGVzYy5sZW47Ci0tIAoyLjI1LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCkludGVsLXdpcmVkLWxhbiBtYWlsaW5nIGxpc3QKSW50ZWwtd2lyZWQtbGFu
QG9zdW9zbC5vcmcKaHR0cHM6Ly9saXN0cy5vc3Vvc2wub3JnL21haWxtYW4vbGlzdGluZm8vaW50
ZWwtd2lyZWQtbGFuCg==
