Return-Path: <intel-wired-lan-bounces@osuosl.org>
X-Original-To: lists+intel-wired-lan@lfdr.de
Delivered-To: lists+intel-wired-lan@lfdr.de
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
	by mail.lfdr.de (Postfix) with ESMTPS id C7DF31DBE15
	for <lists+intel-wired-lan@lfdr.de>; Wed, 20 May 2020 21:38:51 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by hemlock.osuosl.org (Postfix) with ESMTP id 9841388C69;
	Wed, 20 May 2020 19:38:49 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id Lk78ad90h5+q; Wed, 20 May 2020 19:38:49 +0000 (UTC)
Received: from ash.osuosl.org (ash.osuosl.org [140.211.166.34])
	by hemlock.osuosl.org (Postfix) with ESMTP id D2EF388C43;
	Wed, 20 May 2020 19:38:47 +0000 (UTC)
X-Original-To: intel-wired-lan@lists.osuosl.org
Delivered-To: intel-wired-lan@lists.osuosl.org
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by ash.osuosl.org (Postfix) with ESMTP id 201DD1BF424
 for <intel-wired-lan@lists.osuosl.org>; Wed, 20 May 2020 09:49:00 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by whitealder.osuosl.org (Postfix) with ESMTP id 17AC68761B
 for <intel-wired-lan@lists.osuosl.org>; Wed, 20 May 2020 09:49:00 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id Bg-f8Wqez9Lt for <intel-wired-lan@lists.osuosl.org>;
 Wed, 20 May 2020 09:48:58 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mail-pj1-f67.google.com (mail-pj1-f67.google.com
 [209.85.216.67])
 by whitealder.osuosl.org (Postfix) with ESMTPS id 7B2BD875EA
 for <intel-wired-lan@lists.osuosl.org>; Wed, 20 May 2020 09:48:58 +0000 (UTC)
Received: by mail-pj1-f67.google.com with SMTP id q24so1005791pjd.1
 for <intel-wired-lan@lists.osuosl.org>; Wed, 20 May 2020 02:48:58 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=GFrKjcq8B4MCZIxo3nwrivK2SLTkRy6a7yEh0SW4OK8=;
 b=FlD0e/1O8Oyh4Q2S0AUJTWaxG2lo0WbzLi1STpag5cJD580nUcusuTBrff/puw1juS
 JEl0qaCHn8N/GK21VH3srnc0yLQoxTo+lv3mM8s5PZLQRtdCBQZuw7qpDPhHTCKCZ5QI
 SqeKPC60/Ov7F9RaIfgEdz6mp4eKT0TDNXkwBXxpzXhLNJyHvlh9nccxBrxIkm9k1owm
 uTJZFORqCVOXZTVNYr/yxdlvmDKq6TYainuVHVSURwjnG9rroMDzdLFL/NWEGnLklG2y
 lSdQZez3mjYf1HCSeR/4lYu6vB2z6bMMDA987VE2hVoodgjODxS0GpgtvYFdmWGPdd46
 lUXg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=GFrKjcq8B4MCZIxo3nwrivK2SLTkRy6a7yEh0SW4OK8=;
 b=OKMqU8DC/gUsM3QYTJPGeUYrb16FYq49yaAAGqnCGe7gOnrbpV+ImG8VCEKdqp5DbA
 4iMgtf4dnL9v/LYPvCfuvA/bOU4DyHzcNl+zTxkQzzTEXy7H8UcYKrzqb0Nq98WaP/mb
 cc4DIEDpMy5wn7uEBCD7DYcCCDors0r+IzSDRO5+BJxR6x0ogLUZAe4OqZnvWM+D5mh1
 cc3T9xLDZCIgN2smnti04YzTn9RNMgLNSQJndpubxAysD0b2ffgR44utLmb4pKfsmkLO
 PO6kbXObzbWD/PT2II4CjNHAjeSukfUhex4Um67kmtbtxeGJ03YhN3X+iHH+wOXNRRn0
 oIcw==
X-Gm-Message-State: AOAM533sPHlS/41gTYXozwo32uhWEYh0sJHH0J1FY+gMzcMsjbkvJqWD
 uR55j1pYykU6uwQ7hp8GxTI=
X-Google-Smtp-Source: ABdhPJzRIjGJ0yPh7XmIVOaqFICPV5QpQ/lxdV+4o+mlBn6burbKezWrzXVg8fMDk/4/dgvgqpjb2A==
X-Received: by 2002:a17:902:fe0c:: with SMTP id
 g12mr1088249plj.316.1589968137889; 
 Wed, 20 May 2020 02:48:57 -0700 (PDT)
Received: from btopel-mobl.ger.intel.com (fmdmzpr03-ext.fm.intel.com.
 [192.55.54.38])
 by smtp.gmail.com with ESMTPSA id c124sm1707494pfb.187.2020.05.20.02.48.51
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 20 May 2020 02:48:57 -0700 (PDT)
From: =?UTF-8?q?Bj=C3=B6rn=20T=C3=B6pel?= <bjorn.topel@gmail.com>
To: ast@kernel.org, daniel@iogearbox.net, davem@davemloft.net, kuba@kernel.org,
 hawk@kernel.org, john.fastabend@gmail.com, netdev@vger.kernel.org,
 bpf@vger.kernel.org, magnus.karlsson@intel.com, jonathan.lemon@gmail.com,
 jeffrey.t.kirsher@intel.com
Date: Wed, 20 May 2020 11:47:35 +0200
Message-Id: <20200520094742.337678-9-bjorn.topel@gmail.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20200520094742.337678-1-bjorn.topel@gmail.com>
References: <20200520094742.337678-1-bjorn.topel@gmail.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Wed, 20 May 2020 19:38:45 +0000
Subject: [Intel-wired-lan] [PATCH bpf-next v4 08/15] i40e,
 xsk: migrate to new MEM_TYPE_XSK_BUFF_POOL
X-BeenThere: intel-wired-lan@osuosl.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel Wired Ethernet Linux Kernel Driver Development
 <intel-wired-lan.osuosl.org>
List-Unsubscribe: <https://lists.osuosl.org/mailman/options/intel-wired-lan>, 
 <mailto:intel-wired-lan-request@osuosl.org?subject=unsubscribe>
List-Archive: <http://lists.osuosl.org/pipermail/intel-wired-lan/>
List-Post: <mailto:intel-wired-lan@osuosl.org>
List-Help: <mailto:intel-wired-lan-request@osuosl.org?subject=help>
List-Subscribe: <https://lists.osuosl.org/mailman/listinfo/intel-wired-lan>,
 <mailto:intel-wired-lan-request@osuosl.org?subject=subscribe>
Cc: maximmi@mellanox.com,
 =?UTF-8?q?Bj=C3=B6rn=20T=C3=B6pel?= <bjorn.topel@intel.com>,
 maciej.fijalkowski@intel.com, intel-wired-lan@lists.osuosl.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-wired-lan-bounces@osuosl.org
Sender: "Intel-wired-lan" <intel-wired-lan-bounces@osuosl.org>

RnJvbTogQmrDtnJuIFTDtnBlbCA8Ympvcm4udG9wZWxAaW50ZWwuY29tPgoKUmVtb3ZlIE1FTV9U
WVBFX1pFUk9fQ09QWSBpbiBmYXZvciBvZiB0aGUgbmV3IE1FTV9UWVBFX1hTS19CVUZGX1BPT0wK
QVBJcy4gVGhlIEFGX1hEUCB6ZXJvLWNvcHkgcnhfYmkgcmluZyBpcyBub3cgc2ltcGx5IGEgc3Ry
dWN0IHhkcF9idWZmCnBvaW50ZXIuCgpDYzogaW50ZWwtd2lyZWQtbGFuQGxpc3RzLm9zdW9zbC5v
cmcKU2lnbmVkLW9mZi1ieTogQmrDtnJuIFTDtnBlbCA8Ympvcm4udG9wZWxAaW50ZWwuY29tPgot
LS0KIGRyaXZlcnMvbmV0L2V0aGVybmV0L2ludGVsL2k0MGUvaTQwZV9tYWluLmMgfCAgMTkgKy0K
IGRyaXZlcnMvbmV0L2V0aGVybmV0L2ludGVsL2k0MGUvaTQwZV90eHJ4LmggfCAgIDkgKy0KIGRy
aXZlcnMvbmV0L2V0aGVybmV0L2ludGVsL2k0MGUvaTQwZV94c2suYyAgfCAzNTIgKystLS0tLS0t
LS0tLS0tLS0tLS0KIGRyaXZlcnMvbmV0L2V0aGVybmV0L2ludGVsL2k0MGUvaTQwZV94c2suaCAg
fCAgIDEgLQogNCBmaWxlcyBjaGFuZ2VkLCA0NyBpbnNlcnRpb25zKCspLCAzMzQgZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9uZXQvZXRoZXJuZXQvaW50ZWwvaTQwZS9pNDBlX21h
aW4uYyBiL2RyaXZlcnMvbmV0L2V0aGVybmV0L2ludGVsL2k0MGUvaTQwZV9tYWluLmMKaW5kZXgg
M2UxNjk1YmI4MjYyLi5lYTczOTViMzkxZTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvbmV0L2V0aGVy
bmV0L2ludGVsL2k0MGUvaTQwZV9tYWluLmMKKysrIGIvZHJpdmVycy9uZXQvZXRoZXJuZXQvaW50
ZWwvaTQwZS9pNDBlX21haW4uYwpAQCAtMzI2NiwyMSArMzI2NiwxOSBAQCBzdGF0aWMgaW50IGk0
MGVfY29uZmlndXJlX3J4X3Jpbmcoc3RydWN0IGk0MGVfcmluZyAqcmluZykKIAkJcmV0ID0gaTQw
ZV9hbGxvY19yeF9iaV96YyhyaW5nKTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7Ci0JCXJp
bmctPnJ4X2J1Zl9sZW4gPSByaW5nLT54c2tfdW1lbS0+Y2h1bmtfc2l6ZV9ub2hyIC0KLQkJCQkg
ICBYRFBfUEFDS0VUX0hFQURST09NOworCQlyaW5nLT5yeF9idWZfbGVuID0geHNrX3VtZW1fZ2V0
X3J4X2ZyYW1lX3NpemUocmluZy0+eHNrX3VtZW0pOwogCQkvKiBGb3IgQUZfWERQIFpDLCB3ZSBk
aXNhbGxvdyBwYWNrZXRzIHRvIHNwYW4gb24KIAkJICogbXVsdGlwbGUgYnVmZmVycywgdGh1cyBs
ZXR0aW5nIHVzIHNraXAgdGhhdAogCQkgKiBoYW5kbGluZyBpbiB0aGUgZmFzdC1wYXRoLgogCQkg
Ki8KIAkJY2hhaW5fbGVuID0gMTsKLQkJcmluZy0+emNhLmZyZWUgPSBpNDBlX3pjYV9mcmVlOwog
CQlyZXQgPSB4ZHBfcnhxX2luZm9fcmVnX21lbV9tb2RlbCgmcmluZy0+eGRwX3J4cSwKLQkJCQkJ
CSBNRU1fVFlQRV9aRVJPX0NPUFksCi0JCQkJCQkgJnJpbmctPnpjYSk7CisJCQkJCQkgTUVNX1RZ
UEVfWFNLX0JVRkZfUE9PTCwKKwkJCQkJCSBOVUxMKTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiBy
ZXQ7CiAJCWRldl9pbmZvKCZ2c2ktPmJhY2stPnBkZXYtPmRldiwKLQkJCSAiUmVnaXN0ZXJlZCBY
RFAgbWVtIG1vZGVsIE1FTV9UWVBFX1pFUk9fQ09QWSBvbiBSeCByaW5nICVkXG4iLAorCQkJICJS
ZWdpc3RlcmVkIFhEUCBtZW0gbW9kZWwgTUVNX1RZUEVfWFNLX0JVRkZfUE9PTCBvbiBSeCByaW5n
ICVkXG4iLAogCQkJIHJpbmctPnF1ZXVlX2luZGV4KTsKIAogCX0gZWxzZSB7CkBAIC0zMzUxLDkg
KzMzNDksMTIgQEAgc3RhdGljIGludCBpNDBlX2NvbmZpZ3VyZV9yeF9yaW5nKHN0cnVjdCBpNDBl
X3JpbmcgKnJpbmcpCiAJcmluZy0+dGFpbCA9IGh3LT5od19hZGRyICsgSTQwRV9RUlhfVEFJTChw
Zl9xKTsKIAl3cml0ZWwoMCwgcmluZy0+dGFpbCk7CiAKLQlvayA9IHJpbmctPnhza191bWVtID8K
LQkgICAgIGk0MGVfYWxsb2NfcnhfYnVmZmVyc196YyhyaW5nLCBJNDBFX0RFU0NfVU5VU0VEKHJp
bmcpKSA6Ci0JICAgICAhaTQwZV9hbGxvY19yeF9idWZmZXJzKHJpbmcsIEk0MEVfREVTQ19VTlVT
RUQocmluZykpOworCWlmIChyaW5nLT54c2tfdW1lbSkgeworCQl4c2tfYnVmZl9zZXRfcnhxX2lu
Zm8ocmluZy0+eHNrX3VtZW0sICZyaW5nLT54ZHBfcnhxKTsKKwkJb2sgPSBpNDBlX2FsbG9jX3J4
X2J1ZmZlcnNfemMocmluZywgSTQwRV9ERVNDX1VOVVNFRChyaW5nKSk7CisJfSBlbHNlIHsKKwkJ
b2sgPSAhaTQwZV9hbGxvY19yeF9idWZmZXJzKHJpbmcsIEk0MEVfREVTQ19VTlVTRUQocmluZykp
OworCX0KIAlpZiAoIW9rKSB7CiAJCS8qIExvZyB0aGlzIGluIGNhc2UgdGhlIHVzZXIgaGFzIGZv
cmdvdHRlbiB0byBnaXZlIHRoZSBrZXJuZWwKIAkJICogYW55IGJ1ZmZlcnMsIGV2ZW4gbGF0ZXIg
aW4gdGhlIGFwcGxpY2F0aW9uLgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9uZXQvZXRoZXJuZXQvaW50
ZWwvaTQwZS9pNDBlX3R4cnguaCBiL2RyaXZlcnMvbmV0L2V0aGVybmV0L2ludGVsL2k0MGUvaTQw
ZV90eHJ4LmgKaW5kZXggZDM0MzQ5OGU4ZGU1Li41YzI1NTk3N2ZkNTggMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvbmV0L2V0aGVybmV0L2ludGVsL2k0MGUvaTQwZV90eHJ4LmgKKysrIGIvZHJpdmVycy9u
ZXQvZXRoZXJuZXQvaW50ZWwvaTQwZS9pNDBlX3R4cnguaApAQCAtMzAxLDEyICszMDEsNiBAQCBz
dHJ1Y3QgaTQwZV9yeF9idWZmZXIgewogCV9fdTE2IHBhZ2VjbnRfYmlhczsKIH07CiAKLXN0cnVj
dCBpNDBlX3J4X2J1ZmZlcl96YyB7Ci0JZG1hX2FkZHJfdCBkbWE7Ci0Jdm9pZCAqYWRkcjsKLQl1
NjQgaGFuZGxlOwotfTsKLQogc3RydWN0IGk0MGVfcXVldWVfc3RhdHMgewogCXU2NCBwYWNrZXRz
OwogCXU2NCBieXRlczsKQEAgLTM1Niw3ICszNTAsNyBAQCBzdHJ1Y3QgaTQwZV9yaW5nIHsKIAl1
bmlvbiB7CiAJCXN0cnVjdCBpNDBlX3R4X2J1ZmZlciAqdHhfYmk7CiAJCXN0cnVjdCBpNDBlX3J4
X2J1ZmZlciAqcnhfYmk7Ci0JCXN0cnVjdCBpNDBlX3J4X2J1ZmZlcl96YyAqcnhfYmlfemM7CisJ
CXN0cnVjdCB4ZHBfYnVmZiAqKnJ4X2JpX3pjOwogCX07CiAJREVDTEFSRV9CSVRNQVAoc3RhdGUs
IF9fSTQwRV9SSU5HX1NUQVRFX05CSVRTKTsKIAl1MTYgcXVldWVfaW5kZXg7CQkvKiBRdWV1ZSBu
dW1iZXIgb2YgcmluZyAqLwpAQCAtNDE4LDcgKzQxMiw2IEBAIHN0cnVjdCBpNDBlX3Jpbmcgewog
CXN0cnVjdCBpNDBlX2NoYW5uZWwgKmNoOwogCXN0cnVjdCB4ZHBfcnhxX2luZm8geGRwX3J4cTsK
IAlzdHJ1Y3QgeGRwX3VtZW0gKnhza191bWVtOwotCXN0cnVjdCB6ZXJvX2NvcHlfYWxsb2NhdG9y
IHpjYTsgLyogWkMgYWxsb2NhdG9yIGFuY2hvciAqLwogfSBfX19fY2FjaGVsaW5lX2ludGVybm9k
ZWFsaWduZWRfaW5fc21wOwogCiBzdGF0aWMgaW5saW5lIGJvb2wgcmluZ191c2VzX2J1aWxkX3Nr
YihzdHJ1Y3QgaTQwZV9yaW5nICpyaW5nKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9uZXQvZXRoZXJu
ZXQvaW50ZWwvaTQwZS9pNDBlX3hzay5jIGIvZHJpdmVycy9uZXQvZXRoZXJuZXQvaW50ZWwvaTQw
ZS9pNDBlX3hzay5jCmluZGV4IDRmY2E1MmEzMGVhNC4uNDYwZjUwNTJlMWRiIDEwMDY0NAotLS0g
YS9kcml2ZXJzL25ldC9ldGhlcm5ldC9pbnRlbC9pNDBlL2k0MGVfeHNrLmMKKysrIGIvZHJpdmVy
cy9uZXQvZXRoZXJuZXQvaW50ZWwvaTQwZS9pNDBlX3hzay5jCkBAIC0yMyw2OCArMjMsMTEgQEAg
dm9pZCBpNDBlX2NsZWFyX3J4X2JpX3pjKHN0cnVjdCBpNDBlX3JpbmcgKnJ4X3JpbmcpCiAJICAg
ICAgIHNpemVvZigqcnhfcmluZy0+cnhfYmlfemMpICogcnhfcmluZy0+Y291bnQpOwogfQogCi1z
dGF0aWMgc3RydWN0IGk0MGVfcnhfYnVmZmVyX3pjICppNDBlX3J4X2JpKHN0cnVjdCBpNDBlX3Jp
bmcgKnJ4X3JpbmcsIHUzMiBpZHgpCitzdGF0aWMgc3RydWN0IHhkcF9idWZmICoqaTQwZV9yeF9i
aShzdHJ1Y3QgaTQwZV9yaW5nICpyeF9yaW5nLCB1MzIgaWR4KQogewogCXJldHVybiAmcnhfcmlu
Zy0+cnhfYmlfemNbaWR4XTsKIH0KIAotLyoqCi0gKiBpNDBlX3hza191bWVtX2RtYV9tYXAgLSBE
TUEgbWFwcyBhbGwgVU1FTSBtZW1vcnkgZm9yIHRoZSBuZXRkZXYKLSAqIEB2c2k6IEN1cnJlbnQg
VlNJCi0gKiBAdW1lbTogVU1FTSB0byBETUEgbWFwCi0gKgotICogUmV0dXJucyAwIG9uIHN1Y2Nl
c3MsIDwwIG9uIGZhaWx1cmUKLSAqKi8KLXN0YXRpYyBpbnQgaTQwZV94c2tfdW1lbV9kbWFfbWFw
KHN0cnVjdCBpNDBlX3ZzaSAqdnNpLCBzdHJ1Y3QgeGRwX3VtZW0gKnVtZW0pCi17Ci0Jc3RydWN0
IGk0MGVfcGYgKnBmID0gdnNpLT5iYWNrOwotCXN0cnVjdCBkZXZpY2UgKmRldjsKLQl1bnNpZ25l
ZCBpbnQgaSwgajsKLQlkbWFfYWRkcl90IGRtYTsKLQotCWRldiA9ICZwZi0+cGRldi0+ZGV2Owot
CWZvciAoaSA9IDA7IGkgPCB1bWVtLT5ucGdzOyBpKyspIHsKLQkJZG1hID0gZG1hX21hcF9wYWdl
X2F0dHJzKGRldiwgdW1lbS0+cGdzW2ldLCAwLCBQQUdFX1NJWkUsCi0JCQkJCSBETUFfQklESVJF
Q1RJT05BTCwgSTQwRV9SWF9ETUFfQVRUUik7Ci0JCWlmIChkbWFfbWFwcGluZ19lcnJvcihkZXYs
IGRtYSkpCi0JCQlnb3RvIG91dF91bm1hcDsKLQotCQl1bWVtLT5wYWdlc1tpXS5kbWEgPSBkbWE7
Ci0JfQotCi0JcmV0dXJuIDA7Ci0KLW91dF91bm1hcDoKLQlmb3IgKGogPSAwOyBqIDwgaTsgaisr
KSB7Ci0JCWRtYV91bm1hcF9wYWdlX2F0dHJzKGRldiwgdW1lbS0+cGFnZXNbaV0uZG1hLCBQQUdF
X1NJWkUsCi0JCQkJICAgICBETUFfQklESVJFQ1RJT05BTCwgSTQwRV9SWF9ETUFfQVRUUik7Ci0J
CXVtZW0tPnBhZ2VzW2ldLmRtYSA9IDA7Ci0JfQotCi0JcmV0dXJuIC0xOwotfQotCi0vKioKLSAq
IGk0MGVfeHNrX3VtZW1fZG1hX3VubWFwIC0gRE1BIHVubWFwcyBhbGwgVU1FTSBtZW1vcnkgZm9y
IHRoZSBuZXRkZXYKLSAqIEB2c2k6IEN1cnJlbnQgVlNJCi0gKiBAdW1lbTogVU1FTSB0byBETUEg
bWFwCi0gKiovCi1zdGF0aWMgdm9pZCBpNDBlX3hza191bWVtX2RtYV91bm1hcChzdHJ1Y3QgaTQw
ZV92c2kgKnZzaSwgc3RydWN0IHhkcF91bWVtICp1bWVtKQotewotCXN0cnVjdCBpNDBlX3BmICpw
ZiA9IHZzaS0+YmFjazsKLQlzdHJ1Y3QgZGV2aWNlICpkZXY7Ci0JdW5zaWduZWQgaW50IGk7Ci0K
LQlkZXYgPSAmcGYtPnBkZXYtPmRldjsKLQotCWZvciAoaSA9IDA7IGkgPCB1bWVtLT5ucGdzOyBp
KyspIHsKLQkJZG1hX3VubWFwX3BhZ2VfYXR0cnMoZGV2LCB1bWVtLT5wYWdlc1tpXS5kbWEsIFBB
R0VfU0laRSwKLQkJCQkgICAgIERNQV9CSURJUkVDVElPTkFMLCBJNDBFX1JYX0RNQV9BVFRSKTsK
LQotCQl1bWVtLT5wYWdlc1tpXS5kbWEgPSAwOwotCX0KLX0KLQogLyoqCiAgKiBpNDBlX3hza191
bWVtX2VuYWJsZSAtIEVuYWJsZS9hc3NvY2lhdGUgYSBVTUVNIHRvIGEgY2VydGFpbiByaW5nL3Fp
ZAogICogQHZzaTogQ3VycmVudCBWU0kKQEAgLTk3LDcgKzQwLDYgQEAgc3RhdGljIGludCBpNDBl
X3hza191bWVtX2VuYWJsZShzdHJ1Y3QgaTQwZV92c2kgKnZzaSwgc3RydWN0IHhkcF91bWVtICp1
bWVtLAogCQkJCXUxNiBxaWQpCiB7CiAJc3RydWN0IG5ldF9kZXZpY2UgKm5ldGRldiA9IHZzaS0+
bmV0ZGV2OwotCXN0cnVjdCB4ZHBfdW1lbV9mcV9yZXVzZSAqcmV1c2VxOwogCWJvb2wgaWZfcnVu
bmluZzsKIAlpbnQgZXJyOwogCkBAIC0xMTEsMTMgKzUzLDcgQEAgc3RhdGljIGludCBpNDBlX3hz
a191bWVtX2VuYWJsZShzdHJ1Y3QgaTQwZV92c2kgKnZzaSwgc3RydWN0IHhkcF91bWVtICp1bWVt
LAogCSAgICBxaWQgPj0gbmV0ZGV2LT5yZWFsX251bV90eF9xdWV1ZXMpCiAJCXJldHVybiAtRUlO
VkFMOwogCi0JcmV1c2VxID0geHNrX3JldXNlcV9wcmVwYXJlKHZzaS0+cnhfcmluZ3NbMF0tPmNv
dW50KTsKLQlpZiAoIXJldXNlcSkKLQkJcmV0dXJuIC1FTk9NRU07Ci0KLQl4c2tfcmV1c2VxX2Zy
ZWUoeHNrX3JldXNlcV9zd2FwKHVtZW0sIHJldXNlcSkpOwotCi0JZXJyID0gaTQwZV94c2tfdW1l
bV9kbWFfbWFwKHZzaSwgdW1lbSk7CisJZXJyID0geHNrX2J1ZmZfZG1hX21hcCh1bWVtLCAmdnNp
LT5iYWNrLT5wZGV2LT5kZXYsIEk0MEVfUlhfRE1BX0FUVFIpOwogCWlmIChlcnIpCiAJCXJldHVy
biBlcnI7CiAKQEAgLTE3MCw3ICsxMDYsNyBAQCBzdGF0aWMgaW50IGk0MGVfeHNrX3VtZW1fZGlz
YWJsZShzdHJ1Y3QgaTQwZV92c2kgKnZzaSwgdTE2IHFpZCkKIAl9CiAKIAljbGVhcl9iaXQocWlk
LCB2c2ktPmFmX3hkcF96Y19xcHMpOwotCWk0MGVfeHNrX3VtZW1fZG1hX3VubWFwKHZzaSwgdW1l
bSk7CisJeHNrX2J1ZmZfZG1hX3VubWFwKHVtZW0sIEk0MEVfUlhfRE1BX0FUVFIpOwogCiAJaWYg
KGlmX3J1bm5pbmcpIHsKIAkJZXJyID0gaTQwZV9xdWV1ZV9wYWlyX2VuYWJsZSh2c2ksIHFpZCk7
CkBAIC0yMDksMTEgKzE0NSw5IEBAIGludCBpNDBlX3hza191bWVtX3NldHVwKHN0cnVjdCBpNDBl
X3ZzaSAqdnNpLCBzdHJ1Y3QgeGRwX3VtZW0gKnVtZW0sCiAgKiovCiBzdGF0aWMgaW50IGk0MGVf
cnVuX3hkcF96YyhzdHJ1Y3QgaTQwZV9yaW5nICpyeF9yaW5nLCBzdHJ1Y3QgeGRwX2J1ZmYgKnhk
cCkKIHsKLQlzdHJ1Y3QgeGRwX3VtZW0gKnVtZW0gPSByeF9yaW5nLT54c2tfdW1lbTsKIAlpbnQg
ZXJyLCByZXN1bHQgPSBJNDBFX1hEUF9QQVNTOwogCXN0cnVjdCBpNDBlX3JpbmcgKnhkcF9yaW5n
OwogCXN0cnVjdCBicGZfcHJvZyAqeGRwX3Byb2c7Ci0JdTY0IG9mZnNldDsKIAl1MzIgYWN0Owog
CiAJcmN1X3JlYWRfbG9jaygpOwpAQCAtMjIyLDkgKzE1Niw2IEBAIHN0YXRpYyBpbnQgaTQwZV9y
dW5feGRwX3pjKHN0cnVjdCBpNDBlX3JpbmcgKnJ4X3JpbmcsIHN0cnVjdCB4ZHBfYnVmZiAqeGRw
KQogCSAqLwogCXhkcF9wcm9nID0gUkVBRF9PTkNFKHJ4X3JpbmctPnhkcF9wcm9nKTsKIAlhY3Qg
PSBicGZfcHJvZ19ydW5feGRwKHhkcF9wcm9nLCB4ZHApOwotCW9mZnNldCA9IHhkcC0+ZGF0YSAt
IHhkcC0+ZGF0YV9oYXJkX3N0YXJ0OwotCi0JeGRwLT5oYW5kbGUgPSB4c2tfdW1lbV9hZGp1c3Rf
b2Zmc2V0KHVtZW0sIHhkcC0+aGFuZGxlLCBvZmZzZXQpOwogCiAJc3dpdGNoIChhY3QpIHsKIAlj
YXNlIFhEUF9QQVNTOgpAQCAtMjUxLDEwNyArMTgyLDI2IEBAIHN0YXRpYyBpbnQgaTQwZV9ydW5f
eGRwX3pjKHN0cnVjdCBpNDBlX3JpbmcgKnJ4X3JpbmcsIHN0cnVjdCB4ZHBfYnVmZiAqeGRwKQog
CXJldHVybiByZXN1bHQ7CiB9CiAKLS8qKgotICogaTQwZV9hbGxvY19idWZmZXJfemMgLSBBbGxv
Y2F0ZXMgYW4gaTQwZV9yeF9idWZmZXJfemMKLSAqIEByeF9yaW5nOiBSeCByaW5nCi0gKiBAYmk6
IFJ4IGJ1ZmZlciB0byBwb3B1bGF0ZQotICoKLSAqIFRoaXMgZnVuY3Rpb24gYWxsb2NhdGVzIGFu
IFJ4IGJ1ZmZlci4gVGhlIGJ1ZmZlciBjYW4gY29tZSBmcm9tIGZpbGwKLSAqIHF1ZXVlLCBvciB2
aWEgdGhlIHJlY3ljbGUgcXVldWUgKG5leHRfdG9fYWxsb2MpLgotICoKLSAqIFJldHVybnMgdHJ1
ZSBmb3IgYSBzdWNjZXNzZnVsIGFsbG9jYXRpb24sIGZhbHNlIG90aGVyd2lzZQotICoqLwotc3Rh
dGljIGJvb2wgaTQwZV9hbGxvY19idWZmZXJfemMoc3RydWN0IGk0MGVfcmluZyAqcnhfcmluZywK
LQkJCQkgc3RydWN0IGk0MGVfcnhfYnVmZmVyX3pjICpiaSkKLXsKLQlzdHJ1Y3QgeGRwX3VtZW0g
KnVtZW0gPSByeF9yaW5nLT54c2tfdW1lbTsKLQl2b2lkICphZGRyID0gYmktPmFkZHI7Ci0JdTY0
IGhhbmRsZSwgaHI7Ci0KLQlpZiAoYWRkcikgewotCQlyeF9yaW5nLT5yeF9zdGF0cy5wYWdlX3Jl
dXNlX2NvdW50Kys7Ci0JCXJldHVybiB0cnVlOwotCX0KLQotCWlmICgheHNrX3VtZW1fcGVla19h
ZGRyKHVtZW0sICZoYW5kbGUpKSB7Ci0JCXJ4X3JpbmctPnJ4X3N0YXRzLmFsbG9jX3BhZ2VfZmFp
bGVkKys7Ci0JCXJldHVybiBmYWxzZTsKLQl9Ci0KLQlociA9IHVtZW0tPmhlYWRyb29tICsgWERQ
X1BBQ0tFVF9IRUFEUk9PTTsKLQotCWJpLT5kbWEgPSB4ZHBfdW1lbV9nZXRfZG1hKHVtZW0sIGhh
bmRsZSk7Ci0JYmktPmRtYSArPSBocjsKLQotCWJpLT5hZGRyID0geGRwX3VtZW1fZ2V0X2RhdGEo
dW1lbSwgaGFuZGxlKTsKLQliaS0+YWRkciArPSBocjsKLQotCWJpLT5oYW5kbGUgPSB4c2tfdW1l
bV9hZGp1c3Rfb2Zmc2V0KHVtZW0sIGhhbmRsZSwgdW1lbS0+aGVhZHJvb20pOwotCi0JeHNrX3Vt
ZW1fcmVsZWFzZV9hZGRyKHVtZW0pOwotCXJldHVybiB0cnVlOwotfQotCi0vKioKLSAqIGk0MGVf
YWxsb2NfYnVmZmVyX3Nsb3dfemMgLSBBbGxvY2F0ZXMgYW4gaTQwZV9yeF9idWZmZXJfemMKLSAq
IEByeF9yaW5nOiBSeCByaW5nCi0gKiBAYmk6IFJ4IGJ1ZmZlciB0byBwb3B1bGF0ZQotICoKLSAq
IFRoaXMgZnVuY3Rpb24gYWxsb2NhdGVzIGFuIFJ4IGJ1ZmZlci4gVGhlIGJ1ZmZlciBjYW4gY29t
ZSBmcm9tIGZpbGwKLSAqIHF1ZXVlLCBvciB2aWEgdGhlIHJldXNlIHF1ZXVlLgotICoKLSAqIFJl
dHVybnMgdHJ1ZSBmb3IgYSBzdWNjZXNzZnVsIGFsbG9jYXRpb24sIGZhbHNlIG90aGVyd2lzZQot
ICoqLwotc3RhdGljIGJvb2wgaTQwZV9hbGxvY19idWZmZXJfc2xvd196YyhzdHJ1Y3QgaTQwZV9y
aW5nICpyeF9yaW5nLAotCQkJCSAgICAgIHN0cnVjdCBpNDBlX3J4X2J1ZmZlcl96YyAqYmkpCi17
Ci0Jc3RydWN0IHhkcF91bWVtICp1bWVtID0gcnhfcmluZy0+eHNrX3VtZW07Ci0JdTY0IGhhbmRs
ZSwgaHI7Ci0KLQlpZiAoIXhza191bWVtX3BlZWtfYWRkcl9ycSh1bWVtLCAmaGFuZGxlKSkgewot
CQlyeF9yaW5nLT5yeF9zdGF0cy5hbGxvY19wYWdlX2ZhaWxlZCsrOwotCQlyZXR1cm4gZmFsc2U7
Ci0JfQotCi0JaGFuZGxlICY9IHJ4X3JpbmctPnhza191bWVtLT5jaHVua19tYXNrOwotCi0JaHIg
PSB1bWVtLT5oZWFkcm9vbSArIFhEUF9QQUNLRVRfSEVBRFJPT007Ci0KLQliaS0+ZG1hID0geGRw
X3VtZW1fZ2V0X2RtYSh1bWVtLCBoYW5kbGUpOwotCWJpLT5kbWEgKz0gaHI7Ci0KLQliaS0+YWRk
ciA9IHhkcF91bWVtX2dldF9kYXRhKHVtZW0sIGhhbmRsZSk7Ci0JYmktPmFkZHIgKz0gaHI7Ci0K
LQliaS0+aGFuZGxlID0geHNrX3VtZW1fYWRqdXN0X29mZnNldCh1bWVtLCBoYW5kbGUsIHVtZW0t
PmhlYWRyb29tKTsKLQotCXhza191bWVtX3JlbGVhc2VfYWRkcl9ycSh1bWVtKTsKLQlyZXR1cm4g
dHJ1ZTsKLX0KLQotc3RhdGljIF9fYWx3YXlzX2lubGluZSBib29sCi1fX2k0MGVfYWxsb2Nfcnhf
YnVmZmVyc196YyhzdHJ1Y3QgaTQwZV9yaW5nICpyeF9yaW5nLCB1MTYgY291bnQsCi0JCQkgICBi
b29sIGFsbG9jKHN0cnVjdCBpNDBlX3JpbmcgKnJ4X3JpbmcsCi0JCQkJICAgICAgc3RydWN0IGk0
MGVfcnhfYnVmZmVyX3pjICpiaSkpCitib29sIGk0MGVfYWxsb2NfcnhfYnVmZmVyc196YyhzdHJ1
Y3QgaTQwZV9yaW5nICpyeF9yaW5nLCB1MTYgY291bnQpCiB7CiAJdTE2IG50dSA9IHJ4X3Jpbmct
Pm5leHRfdG9fdXNlOwogCXVuaW9uIGk0MGVfcnhfZGVzYyAqcnhfZGVzYzsKLQlzdHJ1Y3QgaTQw
ZV9yeF9idWZmZXJfemMgKmJpOworCXN0cnVjdCB4ZHBfYnVmZiAqKmJpLCAqeGRwOworCWRtYV9h
ZGRyX3QgZG1hOwogCWJvb2wgb2sgPSB0cnVlOwogCiAJcnhfZGVzYyA9IEk0MEVfUlhfREVTQyhy
eF9yaW5nLCBudHUpOwogCWJpID0gaTQwZV9yeF9iaShyeF9yaW5nLCBudHUpOwogCWRvIHsKLQkJ
aWYgKCFhbGxvYyhyeF9yaW5nLCBiaSkpIHsKKwkJeGRwID0geHNrX2J1ZmZfYWxsb2Mocnhfcmlu
Zy0+eHNrX3VtZW0pOworCQlpZiAoIXhkcCkgewogCQkJb2sgPSBmYWxzZTsKIAkJCWdvdG8gbm9f
YnVmZmVyczsKIAkJfQotCi0JCWRtYV9zeW5jX3NpbmdsZV9yYW5nZV9mb3JfZGV2aWNlKHJ4X3Jp
bmctPmRldiwgYmktPmRtYSwgMCwKLQkJCQkJCSByeF9yaW5nLT5yeF9idWZfbGVuLAotCQkJCQkJ
IERNQV9CSURJUkVDVElPTkFMKTsKLQotCQlyeF9kZXNjLT5yZWFkLnBrdF9hZGRyID0gY3B1X3Rv
X2xlNjQoYmktPmRtYSk7CisJCSpiaSA9IHhkcDsKKwkJZG1hID0geHNrX2J1ZmZfeGRwX2dldF9k
bWEoeGRwKTsKKwkJcnhfZGVzYy0+cmVhZC5wa3RfYWRkciA9IGNwdV90b19sZTY0KGRtYSk7CisJ
CXJ4X2Rlc2MtPnJlYWQuaGRyX2FkZHIgPSAwOwogCiAJCXJ4X2Rlc2MrKzsKIAkJYmkrKzsKQEAg
LTM2Myw3ICsyMTMsNiBAQCBfX2k0MGVfYWxsb2NfcnhfYnVmZmVyc196YyhzdHJ1Y3QgaTQwZV9y
aW5nICpyeF9yaW5nLCB1MTYgY291bnQsCiAJCQludHUgPSAwOwogCQl9CiAKLQkJcnhfZGVzYy0+
d2IucXdvcmQxLnN0YXR1c19lcnJvcl9sZW4gPSAwOwogCQljb3VudC0tOwogCX0gd2hpbGUgKGNv
dW50KTsKIApAQCAtMzc0LDEyNiArMjIzLDYgQEAgX19pNDBlX2FsbG9jX3J4X2J1ZmZlcnNfemMo
c3RydWN0IGk0MGVfcmluZyAqcnhfcmluZywgdTE2IGNvdW50LAogCXJldHVybiBvazsKIH0KIAot
LyoqCi0gKiBpNDBlX2FsbG9jX3J4X2J1ZmZlcnNfemMgLSBBbGxvY2F0ZXMgYSBudW1iZXIgb2Yg
UnggYnVmZmVycwotICogQHJ4X3Jpbmc6IFJ4IHJpbmcKLSAqIEBjb3VudDogVGhlIG51bWJlciBv
ZiBidWZmZXJzIHRvIGFsbG9jYXRlCi0gKgotICogVGhpcyBmdW5jdGlvbiBhbGxvY2F0ZXMgYSBu
dW1iZXIgb2YgUnggYnVmZmVycyBmcm9tIHRoZSByZXVzZSBxdWV1ZQotICogb3IgZmlsbCByaW5n
IGFuZCBwbGFjZXMgdGhlbSBvbiB0aGUgUnggcmluZy4KLSAqCi0gKiBSZXR1cm5zIHRydWUgZm9y
IGEgc3VjY2Vzc2Z1bCBhbGxvY2F0aW9uLCBmYWxzZSBvdGhlcndpc2UKLSAqKi8KLWJvb2wgaTQw
ZV9hbGxvY19yeF9idWZmZXJzX3pjKHN0cnVjdCBpNDBlX3JpbmcgKnJ4X3JpbmcsIHUxNiBjb3Vu
dCkKLXsKLQlyZXR1cm4gX19pNDBlX2FsbG9jX3J4X2J1ZmZlcnNfemMocnhfcmluZywgY291bnQs
Ci0JCQkJCSAgaTQwZV9hbGxvY19idWZmZXJfc2xvd196Yyk7Ci19Ci0KLS8qKgotICogaTQwZV9h
bGxvY19yeF9idWZmZXJzX2Zhc3RfemMgLSBBbGxvY2F0ZXMgYSBudW1iZXIgb2YgUnggYnVmZmVy
cwotICogQHJ4X3Jpbmc6IFJ4IHJpbmcKLSAqIEBjb3VudDogVGhlIG51bWJlciBvZiBidWZmZXJz
IHRvIGFsbG9jYXRlCi0gKgotICogVGhpcyBmdW5jdGlvbiBhbGxvY2F0ZXMgYSBudW1iZXIgb2Yg
UnggYnVmZmVycyBmcm9tIHRoZSBmaWxsIHJpbmcKLSAqIG9yIHRoZSBpbnRlcm5hbCByZWN5Y2xl
IG1lY2hhbmlzbSBhbmQgcGxhY2VzIHRoZW0gb24gdGhlIFJ4IHJpbmcuCi0gKgotICogUmV0dXJu
cyB0cnVlIGZvciBhIHN1Y2Nlc3NmdWwgYWxsb2NhdGlvbiwgZmFsc2Ugb3RoZXJ3aXNlCi0gKiov
Ci1zdGF0aWMgYm9vbCBpNDBlX2FsbG9jX3J4X2J1ZmZlcnNfZmFzdF96YyhzdHJ1Y3QgaTQwZV9y
aW5nICpyeF9yaW5nLCB1MTYgY291bnQpCi17Ci0JcmV0dXJuIF9faTQwZV9hbGxvY19yeF9idWZm
ZXJzX3pjKHJ4X3JpbmcsIGNvdW50LAotCQkJCQkgIGk0MGVfYWxsb2NfYnVmZmVyX3pjKTsKLX0K
LQotLyoqCi0gKiBpNDBlX2dldF9yeF9idWZmZXJfemMgLSBSZXR1cm4gdGhlIGN1cnJlbnQgUngg
YnVmZmVyCi0gKiBAcnhfcmluZzogUnggcmluZwotICogQHNpemU6IFRoZSBzaXplIG9mIHRoZSBy
eCBidWZmZXIgKHJlYWQgZnJvbSBkZXNjcmlwdG9yKQotICoKLSAqIFRoaXMgZnVuY3Rpb24gcmV0
dXJucyB0aGUgY3VycmVudCwgcmVjZWl2ZWQgUnggYnVmZmVyLCBhbmQgYWxzbwotICogZG9lcyBE
TUEgc3luY2hyb25pemF0aW9uLiAgdGhlIFJ4IHJpbmcuCi0gKgotICogUmV0dXJucyB0aGUgcmVj
ZWl2ZWQgUnggYnVmZmVyCi0gKiovCi1zdGF0aWMgc3RydWN0IGk0MGVfcnhfYnVmZmVyX3pjICpp
NDBlX2dldF9yeF9idWZmZXJfemMoCi0Jc3RydWN0IGk0MGVfcmluZyAqcnhfcmluZywKLQljb25z
dCB1bnNpZ25lZCBpbnQgc2l6ZSkKLXsKLQlzdHJ1Y3QgaTQwZV9yeF9idWZmZXJfemMgKmJpOwot
Ci0JYmkgPSBpNDBlX3J4X2JpKHJ4X3JpbmcsIHJ4X3JpbmctPm5leHRfdG9fY2xlYW4pOwotCi0J
Lyogd2UgYXJlIHJldXNpbmcgc28gc3luYyB0aGlzIGJ1ZmZlciBmb3IgQ1BVIHVzZSAqLwotCWRt
YV9zeW5jX3NpbmdsZV9yYW5nZV9mb3JfY3B1KHJ4X3JpbmctPmRldiwKLQkJCQkgICAgICBiaS0+
ZG1hLCAwLAotCQkJCSAgICAgIHNpemUsCi0JCQkJICAgICAgRE1BX0JJRElSRUNUSU9OQUwpOwot
Ci0JcmV0dXJuIGJpOwotfQotCi0vKioKLSAqIGk0MGVfcmV1c2VfcnhfYnVmZmVyX3pjIC0gUmVj
eWNsZSBhbiBSeCBidWZmZXIKLSAqIEByeF9yaW5nOiBSeCByaW5nCi0gKiBAb2xkX2JpOiBUaGUg
UnggYnVmZmVyIHRvIHJlY3ljbGUKLSAqCi0gKiBUaGlzIGZ1bmN0aW9uIHJlY3ljbGVzIGEgZmlu
aXNoZWQgUnggYnVmZmVyLCBhbmQgcGxhY2VzIGl0IG9uIHRoZQotICogcmVjeWNsZSBxdWV1ZSAo
bmV4dF90b19hbGxvYykuCi0gKiovCi1zdGF0aWMgdm9pZCBpNDBlX3JldXNlX3J4X2J1ZmZlcl96
YyhzdHJ1Y3QgaTQwZV9yaW5nICpyeF9yaW5nLAotCQkJCSAgICBzdHJ1Y3QgaTQwZV9yeF9idWZm
ZXJfemMgKm9sZF9iaSkKLXsKLQlzdHJ1Y3QgaTQwZV9yeF9idWZmZXJfemMgKm5ld19iaSA9IGk0
MGVfcnhfYmkocnhfcmluZywKLQkJCQkJCSAgICAgIHJ4X3JpbmctPm5leHRfdG9fYWxsb2MpOwot
CXUxNiBudGEgPSByeF9yaW5nLT5uZXh0X3RvX2FsbG9jOwotCi0JLyogdXBkYXRlLCBhbmQgc3Rv
cmUgbmV4dCB0byBhbGxvYyAqLwotCW50YSsrOwotCXJ4X3JpbmctPm5leHRfdG9fYWxsb2MgPSAo
bnRhIDwgcnhfcmluZy0+Y291bnQpID8gbnRhIDogMDsKLQotCS8qIHRyYW5zZmVyIHBhZ2UgZnJv
bSBvbGQgYnVmZmVyIHRvIG5ldyBidWZmZXIgKi8KLQluZXdfYmktPmRtYSA9IG9sZF9iaS0+ZG1h
OwotCW5ld19iaS0+YWRkciA9IG9sZF9iaS0+YWRkcjsKLQluZXdfYmktPmhhbmRsZSA9IG9sZF9i
aS0+aGFuZGxlOwotCi0Jb2xkX2JpLT5hZGRyID0gTlVMTDsKLX0KLQotLyoqCi0gKiBpNDBlX3pj
YV9mcmVlIC0gRnJlZSBjYWxsYmFjayBmb3IgTUVNX1RZUEVfWkVST19DT1BZIGFsbG9jYXRpb25z
Ci0gKiBAYWxsb2M6IFplcm8tY29weSBhbGxvY2F0b3IKLSAqIEBoYW5kbGU6IEJ1ZmZlciBoYW5k
bGUKLSAqKi8KLXZvaWQgaTQwZV96Y2FfZnJlZShzdHJ1Y3QgemVyb19jb3B5X2FsbG9jYXRvciAq
YWxsb2MsIHVuc2lnbmVkIGxvbmcgaGFuZGxlKQotewotCXN0cnVjdCBpNDBlX3J4X2J1ZmZlcl96
YyAqYmk7Ci0Jc3RydWN0IGk0MGVfcmluZyAqcnhfcmluZzsKLQl1NjQgaHIsIG1hc2s7Ci0JdTE2
IG50YTsKLQotCXJ4X3JpbmcgPSBjb250YWluZXJfb2YoYWxsb2MsIHN0cnVjdCBpNDBlX3Jpbmcs
IHpjYSk7Ci0JaHIgPSByeF9yaW5nLT54c2tfdW1lbS0+aGVhZHJvb20gKyBYRFBfUEFDS0VUX0hF
QURST09NOwotCW1hc2sgPSByeF9yaW5nLT54c2tfdW1lbS0+Y2h1bmtfbWFzazsKLQotCW50YSA9
IHJ4X3JpbmctPm5leHRfdG9fYWxsb2M7Ci0JYmkgPSBpNDBlX3J4X2JpKHJ4X3JpbmcsIG50YSk7
Ci0KLQludGErKzsKLQlyeF9yaW5nLT5uZXh0X3RvX2FsbG9jID0gKG50YSA8IHJ4X3JpbmctPmNv
dW50KSA/IG50YSA6IDA7Ci0KLQloYW5kbGUgJj0gbWFzazsKLQotCWJpLT5kbWEgPSB4ZHBfdW1l
bV9nZXRfZG1hKHJ4X3JpbmctPnhza191bWVtLCBoYW5kbGUpOwotCWJpLT5kbWEgKz0gaHI7Ci0K
LQliaS0+YWRkciA9IHhkcF91bWVtX2dldF9kYXRhKHJ4X3JpbmctPnhza191bWVtLCBoYW5kbGUp
OwotCWJpLT5hZGRyICs9IGhyOwotCi0JYmktPmhhbmRsZSA9IHhza191bWVtX2FkanVzdF9vZmZz
ZXQocnhfcmluZy0+eHNrX3VtZW0sICh1NjQpaGFuZGxlLAotCQkJCQkgICAgcnhfcmluZy0+eHNr
X3VtZW0tPmhlYWRyb29tKTsKLX0KLQogLyoqCiAgKiBpNDBlX2NvbnN0cnVjdF9za2JfemMgLSBD
cmVhdGUgc2tidWZmZiBmcm9tIHplcm8tY29weSBSeCBidWZmZXIKICAqIEByeF9yaW5nOiBSeCBy
aW5nCkBAIC01MDUsNyArMjM0LDYgQEAgdm9pZCBpNDBlX3pjYV9mcmVlKHN0cnVjdCB6ZXJvX2Nv
cHlfYWxsb2NhdG9yICphbGxvYywgdW5zaWduZWQgbG9uZyBoYW5kbGUpCiAgKiBSZXR1cm5zIHRo
ZSBza2IsIG9yIE5VTEwgb24gZmFpbHVyZS4KICAqKi8KIHN0YXRpYyBzdHJ1Y3Qgc2tfYnVmZiAq
aTQwZV9jb25zdHJ1Y3Rfc2tiX3pjKHN0cnVjdCBpNDBlX3JpbmcgKnJ4X3JpbmcsCi0JCQkJCSAg
ICAgc3RydWN0IGk0MGVfcnhfYnVmZmVyX3pjICpiaSwKIAkJCQkJICAgICBzdHJ1Y3QgeGRwX2J1
ZmYgKnhkcCkKIHsKIAl1bnNpZ25lZCBpbnQgbWV0YXNpemUgPSB4ZHAtPmRhdGEgLSB4ZHAtPmRh
dGFfbWV0YTsKQEAgLTUyNCw3ICsyNTIsNyBAQCBzdGF0aWMgc3RydWN0IHNrX2J1ZmYgKmk0MGVf
Y29uc3RydWN0X3NrYl96YyhzdHJ1Y3QgaTQwZV9yaW5nICpyeF9yaW5nLAogCWlmIChtZXRhc2l6
ZSkKIAkJc2tiX21ldGFkYXRhX3NldChza2IsIG1ldGFzaXplKTsKIAotCWk0MGVfcmV1c2Vfcnhf
YnVmZmVyX3pjKHJ4X3JpbmcsIGJpKTsKKwl4c2tfYnVmZl9mcmVlKHhkcCk7CiAJcmV0dXJuIHNr
YjsKIH0KIApAQCAtNTM5LDI1ICsyNjcsMjAgQEAgaW50IGk0MGVfY2xlYW5fcnhfaXJxX3pjKHN0
cnVjdCBpNDBlX3JpbmcgKnJ4X3JpbmcsIGludCBidWRnZXQpCiB7CiAJdW5zaWduZWQgaW50IHRv
dGFsX3J4X2J5dGVzID0gMCwgdG90YWxfcnhfcGFja2V0cyA9IDA7CiAJdTE2IGNsZWFuZWRfY291
bnQgPSBJNDBFX0RFU0NfVU5VU0VEKHJ4X3JpbmcpOwotCXN0cnVjdCB4ZHBfdW1lbSAqdW1lbSA9
IHJ4X3JpbmctPnhza191bWVtOwogCXVuc2lnbmVkIGludCB4ZHBfcmVzLCB4ZHBfeG1pdCA9IDA7
CiAJYm9vbCBmYWlsdXJlID0gZmFsc2U7CiAJc3RydWN0IHNrX2J1ZmYgKnNrYjsKLQlzdHJ1Y3Qg
eGRwX2J1ZmYgeGRwOwotCi0JeGRwLnJ4cSA9ICZyeF9yaW5nLT54ZHBfcnhxOwotCXhkcC5mcmFt
ZV9zeiA9IHhza191bWVtX3hkcF9mcmFtZV9zeih1bWVtKTsKIAogCXdoaWxlIChsaWtlbHkodG90
YWxfcnhfcGFja2V0cyA8ICh1bnNpZ25lZCBpbnQpYnVkZ2V0KSkgewotCQlzdHJ1Y3QgaTQwZV9y
eF9idWZmZXJfemMgKmJpOwogCQl1bmlvbiBpNDBlX3J4X2Rlc2MgKnJ4X2Rlc2M7CisJCXN0cnVj
dCB4ZHBfYnVmZiAqKmJpOwogCQl1bnNpZ25lZCBpbnQgc2l6ZTsKIAkJdTY0IHF3b3JkOwogCiAJ
CWlmIChjbGVhbmVkX2NvdW50ID49IEk0MEVfUlhfQlVGRkVSX1dSSVRFKSB7CiAJCQlmYWlsdXJl
ID0gZmFpbHVyZSB8fAotCQkJCSAgIWk0MGVfYWxsb2NfcnhfYnVmZmVyc19mYXN0X3pjKHJ4X3Jp
bmcsCi0JCQkJCQkJCSBjbGVhbmVkX2NvdW50KTsKKwkJCQkgICFpNDBlX2FsbG9jX3J4X2J1ZmZl
cnNfemMocnhfcmluZywKKwkJCQkJCQkgICAgY2xlYW5lZF9jb3VudCk7CiAJCQljbGVhbmVkX2Nv
dW50ID0gMDsKIAkJfQogCkBAIC01NzUsOSArMjk4LDEwIEBAIGludCBpNDBlX2NsZWFuX3J4X2ly
cV96YyhzdHJ1Y3QgaTQwZV9yaW5nICpyeF9yaW5nLCBpbnQgYnVkZ2V0KQogCQkJCQkJICAgICAg
cnhfZGVzYy0+cmF3LnF3b3JkWzBdLAogCQkJCQkJICAgICAgcXdvcmQpOwogCQkJYmkgPSBpNDBl
X3J4X2JpKHJ4X3JpbmcsIHJ4X3JpbmctPm5leHRfdG9fY2xlYW4pOwotCQkJaTQwZV9pbmNfbnRj
KHJ4X3JpbmcpOwotCQkJaTQwZV9yZXVzZV9yeF9idWZmZXJfemMocnhfcmluZywgYmkpOworCQkJ
eHNrX2J1ZmZfZnJlZSgqYmkpOworCQkJKmJpID0gTlVMTDsKIAkJCWNsZWFuZWRfY291bnQrKzsK
KwkJCWk0MGVfaW5jX250YyhyeF9yaW5nKTsKIAkJCWNvbnRpbnVlOwogCQl9CiAKQEAgLTU4Nywy
MiArMzExLDE4IEBAIGludCBpNDBlX2NsZWFuX3J4X2lycV96YyhzdHJ1Y3QgaTQwZV9yaW5nICpy
eF9yaW5nLCBpbnQgYnVkZ2V0KQogCQlpZiAoIXNpemUpCiAJCQlicmVhazsKIAotCQliaSA9IGk0
MGVfZ2V0X3J4X2J1ZmZlcl96YyhyeF9yaW5nLCBzaXplKTsKLQkJeGRwLmRhdGEgPSBiaS0+YWRk
cjsKLQkJeGRwLmRhdGFfbWV0YSA9IHhkcC5kYXRhOwotCQl4ZHAuZGF0YV9oYXJkX3N0YXJ0ID0g
eGRwLmRhdGEgLSBYRFBfUEFDS0VUX0hFQURST09NOwotCQl4ZHAuZGF0YV9lbmQgPSB4ZHAuZGF0
YSArIHNpemU7Ci0JCXhkcC5oYW5kbGUgPSBiaS0+aGFuZGxlOworCQliaSA9IGk0MGVfcnhfYmko
cnhfcmluZywgcnhfcmluZy0+bmV4dF90b19jbGVhbik7CisJCSgqYmkpLT5kYXRhX2VuZCA9ICgq
YmkpLT5kYXRhICsgc2l6ZTsKKwkJeHNrX2J1ZmZfZG1hX3N5bmNfZm9yX2NwdSgqYmkpOwogCi0J
CXhkcF9yZXMgPSBpNDBlX3J1bl94ZHBfemMocnhfcmluZywgJnhkcCk7CisJCXhkcF9yZXMgPSBp
NDBlX3J1bl94ZHBfemMocnhfcmluZywgKmJpKTsKIAkJaWYgKHhkcF9yZXMpIHsKLQkJCWlmICh4
ZHBfcmVzICYgKEk0MEVfWERQX1RYIHwgSTQwRV9YRFBfUkVESVIpKSB7CisJCQlpZiAoeGRwX3Jl
cyAmIChJNDBFX1hEUF9UWCB8IEk0MEVfWERQX1JFRElSKSkKIAkJCQl4ZHBfeG1pdCB8PSB4ZHBf
cmVzOwotCQkJCWJpLT5hZGRyID0gTlVMTDsKLQkJCX0gZWxzZSB7Ci0JCQkJaTQwZV9yZXVzZV9y
eF9idWZmZXJfemMocnhfcmluZywgYmkpOwotCQkJfQorCQkJZWxzZQorCQkJCXhza19idWZmX2Zy
ZWUoKmJpKTsKIAorCQkJKmJpID0gTlVMTDsKIAkJCXRvdGFsX3J4X2J5dGVzICs9IHNpemU7CiAJ
CQl0b3RhbF9yeF9wYWNrZXRzKys7CiAKQEAgLTYxOCw3ICszMzgsOCBAQCBpbnQgaTQwZV9jbGVh
bl9yeF9pcnFfemMoc3RydWN0IGk0MGVfcmluZyAqcnhfcmluZywgaW50IGJ1ZGdldCkKIAkJICog
QklUKEk0MEVfUlhEX1FXMV9FUlJPUl9TSElGVCkuIFRoaXMgaXMgZHVlIHRvIHRoYXQKIAkJICog
U0JQIGlzICpub3QqIHNldCBpbiBQUlRfU0JQVlNJIChkZWZhdWx0IG5vdCBzZXQpLgogCQkgKi8K
LQkJc2tiID0gaTQwZV9jb25zdHJ1Y3Rfc2tiX3pjKHJ4X3JpbmcsIGJpLCAmeGRwKTsKKwkJc2ti
ID0gaTQwZV9jb25zdHJ1Y3Rfc2tiX3pjKHJ4X3JpbmcsICpiaSk7CisJCSpiaSA9IE5VTEw7CiAJ
CWlmICghc2tiKSB7CiAJCQlyeF9yaW5nLT5yeF9zdGF0cy5hbGxvY19idWZmX2ZhaWxlZCsrOwog
CQkJYnJlYWs7CkBAIC02NzYsMTAgKzM5Nyw5IEBAIHN0YXRpYyBib29sIGk0MGVfeG1pdF96Yyhz
dHJ1Y3QgaTQwZV9yaW5nICp4ZHBfcmluZywgdW5zaWduZWQgaW50IGJ1ZGdldCkKIAkJaWYgKCF4
c2tfdW1lbV9jb25zdW1lX3R4KHhkcF9yaW5nLT54c2tfdW1lbSwgJmRlc2MpKQogCQkJYnJlYWs7
CiAKLQkJZG1hID0geGRwX3VtZW1fZ2V0X2RtYSh4ZHBfcmluZy0+eHNrX3VtZW0sIGRlc2MuYWRk
cik7Ci0KLQkJZG1hX3N5bmNfc2luZ2xlX2Zvcl9kZXZpY2UoeGRwX3JpbmctPmRldiwgZG1hLCBk
ZXNjLmxlbiwKLQkJCQkJICAgRE1BX0JJRElSRUNUSU9OQUwpOworCQlkbWEgPSB4c2tfYnVmZl9y
YXdfZ2V0X2RtYSh4ZHBfcmluZy0+eHNrX3VtZW0sIGRlc2MuYWRkcik7CisJCXhza19idWZmX3Jh
d19kbWFfc3luY19mb3JfZGV2aWNlKHhkcF9yaW5nLT54c2tfdW1lbSwgZG1hLAorCQkJCQkJIGRl
c2MubGVuKTsKIAogCQl0eF9iaSA9ICZ4ZHBfcmluZy0+dHhfYmlbeGRwX3JpbmctPm5leHRfdG9f
dXNlXTsKIAkJdHhfYmktPmJ5dGVjb3VudCA9IGRlc2MubGVuOwpAQCAtODM4LDEzICs1NTgsMTMg
QEAgdm9pZCBpNDBlX3hza19jbGVhbl9yeF9yaW5nKHN0cnVjdCBpNDBlX3JpbmcgKnJ4X3Jpbmcp
CiAJdTE2IGk7CiAKIAlmb3IgKGkgPSAwOyBpIDwgcnhfcmluZy0+Y291bnQ7IGkrKykgewotCQlz
dHJ1Y3QgaTQwZV9yeF9idWZmZXJfemMgKnJ4X2JpID0gaTQwZV9yeF9iaShyeF9yaW5nLCBpKTsK
KwkJc3RydWN0IHhkcF9idWZmICpyeF9iaSA9ICppNDBlX3J4X2JpKHJ4X3JpbmcsIGkpOwogCi0J
CWlmICghcnhfYmktPmFkZHIpCisJCWlmICghcnhfYmkpCiAJCQljb250aW51ZTsKIAotCQl4c2tf
dW1lbV9mcV9yZXVzZShyeF9yaW5nLT54c2tfdW1lbSwgcnhfYmktPmhhbmRsZSk7Ci0JCXJ4X2Jp
LT5hZGRyID0gTlVMTDsKKwkJeHNrX2J1ZmZfZnJlZShyeF9iaSk7CisJCXJ4X2JpID0gTlVMTDsK
IAl9CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvbmV0L2V0aGVybmV0L2ludGVsL2k0MGUvaTQw
ZV94c2suaCBiL2RyaXZlcnMvbmV0L2V0aGVybmV0L2ludGVsL2k0MGUvaTQwZV94c2suaAppbmRl
eCBmNWUyOTJjMjE4ZWUuLmVhOTE5YTdkNjBlYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9uZXQvZXRo
ZXJuZXQvaW50ZWwvaTQwZS9pNDBlX3hzay5oCisrKyBiL2RyaXZlcnMvbmV0L2V0aGVybmV0L2lu
dGVsL2k0MGUvaTQwZV94c2suaApAQCAtMTIsNyArMTIsNiBAQCBpbnQgaTQwZV9xdWV1ZV9wYWly
X2Rpc2FibGUoc3RydWN0IGk0MGVfdnNpICp2c2ksIGludCBxdWV1ZV9wYWlyKTsKIGludCBpNDBl
X3F1ZXVlX3BhaXJfZW5hYmxlKHN0cnVjdCBpNDBlX3ZzaSAqdnNpLCBpbnQgcXVldWVfcGFpcik7
CiBpbnQgaTQwZV94c2tfdW1lbV9zZXR1cChzdHJ1Y3QgaTQwZV92c2kgKnZzaSwgc3RydWN0IHhk
cF91bWVtICp1bWVtLAogCQkJdTE2IHFpZCk7Ci12b2lkIGk0MGVfemNhX2ZyZWUoc3RydWN0IHpl
cm9fY29weV9hbGxvY2F0b3IgKmFsbG9jLCB1bnNpZ25lZCBsb25nIGhhbmRsZSk7CiBib29sIGk0
MGVfYWxsb2NfcnhfYnVmZmVyc196YyhzdHJ1Y3QgaTQwZV9yaW5nICpyeF9yaW5nLCB1MTYgY2xl
YW5lZF9jb3VudCk7CiBpbnQgaTQwZV9jbGVhbl9yeF9pcnFfemMoc3RydWN0IGk0MGVfcmluZyAq
cnhfcmluZywgaW50IGJ1ZGdldCk7CiAKLS0gCjIuMjUuMQoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtd2lyZWQtbGFuIG1haWxpbmcgbGlzdApJ
bnRlbC13aXJlZC1sYW5Ab3N1b3NsLm9yZwpodHRwczovL2xpc3RzLm9zdW9zbC5vcmcvbWFpbG1h
bi9saXN0aW5mby9pbnRlbC13aXJlZC1sYW4K
